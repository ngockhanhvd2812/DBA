- [H∆∞·ªõng D·∫´n V·∫≠n H√†nh V√† Gi√°m S√°t Oracle \& MongoDB](#h∆∞·ªõng-d·∫´n-v·∫≠n-h√†nh-v√†-gi√°m-s√°t-oracle--mongodb)
  - [Ph·∫ßn I: Oracle Database](#ph·∫ßn-i-oracle-database)
    - [1. Ki·∫øn Tr√∫c C·ªët L√µi](#1-ki·∫øn-tr√∫c-c·ªët-l√µi)
    - [2. V·∫≠n H√†nh C∆° B·∫£n Trong M√¥i Tr∆∞·ªùng RAC](#2-v·∫≠n-h√†nh-c∆°-b·∫£n-trong-m√¥i-tr∆∞·ªùng-rac)
      - [2.1 S·ª± Kh√°c Bi·ªát Gi·ªØa T√†i Kho·∫£n `oracle` v√† `grid`](#21-s·ª±-kh√°c-bi·ªát-gi·ªØa-t√†i-kho·∫£n-oracle-v√†-grid)
      - [2.2 C√°c C√¢u L·ªánh V·∫≠n H√†nh Ch√≠nh v√† T√¨nh Hu·ªëng S·ª≠ D·ª•ng](#22-c√°c-c√¢u-l·ªánh-v·∫≠n-h√†nh-ch√≠nh-v√†-t√¨nh-hu·ªëng-s·ª≠-d·ª•ng)
      - [2.3 Quy Tr√¨nh X·ª≠ L√Ω S·ª± C·ªë Ti√™u Chu·∫©n](#23-quy-tr√¨nh-x·ª≠-l√Ω-s·ª±-c·ªë-ti√™u-chu·∫©n)
      - [2.4 Quy Tr√¨nh Kh·ªüi ƒê·ªông (Startup) M·ªôt C∆° S·ªü D·ªØ Li·ªáu RAC](#24-quy-tr√¨nh-kh·ªüi-ƒë·ªông-startup-m·ªôt-c∆°-s·ªü-d·ªØ-li·ªáu-rac)
    - [3. Gi√°m S√°t V√† Ch·∫©n ƒêo√°n Hi·ªáu NƒÉng](#3-gi√°m-s√°t-v√†-ch·∫©n-ƒëo√°n-hi·ªáu-nƒÉng)
  - [Ph·∫ßn II: MongoDB](#ph·∫ßn-ii-mongodb)
    - [1. Ki·∫øn Tr√∫c Sharding (Ph√¢n M·∫£nh)](#1-ki·∫øn-tr√∫c-sharding-ph√¢n-m·∫£nh)
    - [2. V·∫≠n H√†nh V√† Gi√°m S√°t](#2-v·∫≠n-h√†nh-v√†-gi√°m-s√°t)
      - [1. Quy Tr√¨nh Import D·ªØ Li·ªáu V√†o Sharded Cluster](#1-quy-tr√¨nh-import-d·ªØ-li·ªáu-v√†o-sharded-cluster)
      - [2. Gi√°m S√°t V·ªõi MongoDB Compass](#2-gi√°m-s√°t-v·ªõi-mongodb-compass)
  - [Ph·∫ßn III: T·ªïng k·∫øt](#ph·∫ßn-iii-t·ªïng-k·∫øt)
    - [Checklist H√†ng Ng√†y](#checklist-h√†ng-ng√†y)
    - [C√¥ng C·ª• H·ªó Tr·ª£](#c√¥ng-c·ª•-h·ªó-tr·ª£)


# H∆∞·ªõng D·∫´n V·∫≠n H√†nh V√† Gi√°m S√°t Oracle & MongoDB

## Ph·∫ßn I: Oracle Database

### 1. Ki·∫øn Tr√∫c C·ªët L√µi

**1.1 Oracle Real Application Clusters (RAC)**

Oracle RAC cho ph√©p nhi·ªÅu m√°y ch·ªß (nodes) c√πng truy c·∫≠p v√†o m·ªôt c∆° s·ªü d·ªØ li·ªáu duy nh·∫•t, mang l·∫°i t√≠nh s·∫µn s√†ng cao v√† kh·∫£ nƒÉng m·ªü r·ªông. ƒêi·ªÅu n√†y ƒë·∫∑c bi·ªát h·ªØu √≠ch khi h·ªá th·ªëng c·∫ßn ho·∫°t ƒë·ªông li√™n t·ª•c 24/7, gi·∫£m thi·ªÉu th·ªùi gian ng·ª´ng ho·∫°t ƒë·ªông (downtime) khi m·ªôt node g·∫∑p s·ª± c·ªë, tƒÉng kh·∫£ nƒÉng x·ª≠ l√Ω song song v√† d·ªÖ d√†ng m·ªü r·ªông quy m√¥.

```mermaid
graph TD
    subgraph "Clients/Application"
        A[App Server 1]
        B[App Server 2]
    end
    subgraph "Oracle RAC Cluster"
        N1[Node 1: Oracle Instance]
        N2[Node 2: Oracle Instance]
    end
    SS[Shared Storage <br> ASM Disks]
    A --> N1
    B --> N2
    N1 <-->|Cluster Interconnect| N2
    N1 --> SS
    N2 --> SS
    %% Styling
    style A fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    style B fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    style N1 fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style N2 fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000
    style SS fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
```

**Gi·∫£i th√≠ch s∆° ƒë·ªì:**
- **Node 1 & Node 2:** M·ªói node l√† m·ªôt m√°y ch·ªß v·∫≠t l√Ω ho·∫∑c ·∫£o ch·∫°y m·ªôt instance Oracle, x·ª≠ l√Ω c√°c y√™u c·∫ßu t·ª´ ·ª©ng d·ª•ng.
- **Cluster Interconnect:** M·∫°ng ri√™ng t·ªëc ƒë·ªô cao ƒë·ªÉ c√°c node trao ƒë·ªïi th√¥ng tin (cache fusion, heartbeat). N·∫øu k·∫øt n·ªëi n√†y ch·∫≠m ho·∫∑c kh√¥ng ·ªïn ƒë·ªãnh, hi·ªáu nƒÉng RAC c√≥ th·ªÉ k√©m h∆°n so v·ªõi m·ªôt instance ƒë∆°n l·∫ª.
- **Shared Storage:** N∆°i l∆∞u tr·ªØ d·ªØ li·ªáu chung, th∆∞·ªùng s·ª≠ d·ª•ng Automatic Storage Management (ASM) ƒë·ªÉ qu·∫£n l√Ω hi·ªáu qu·∫£.

**L∆∞u √Ω quan tr·ªçng:** ƒê·∫£m b·∫£o Cluster Interconnect c√≥ ƒë·ªô tr·ªÖ th·∫•p ƒë·ªÉ tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn hi·ªáu su·∫•t t·ªïng th·ªÉ.

**1.2 Ki·∫øn Tr√∫c Multitenant (CDB & PDB)**

Ki·∫øn tr√∫c n√†y cho ph√©p qu·∫£n l√Ω nhi·ªÅu c∆° s·ªü d·ªØ li·ªáu ƒë·ªôc l·∫≠p trong m·ªôt container chung, ti·∫øt ki·ªám t√†i nguy√™n h·ªá th·ªëng (CPU, RAM, storage), h·ªó tr·ª£ tri·ªÉn khai nhanh ch√≥ng v√† t√°ch bi·ªát d·ªØ li·ªáu gi·ªØa c√°c ·ª©ng d·ª•ng.

```mermaid
graph TD
    subgraph "Server"
        CDB["Container Database (CDB#36;ROOT)"]
        subgraph "Pluggable Databases (PDBs)"
            PDB1["PDB_HR <br> (Ch·ª©a d·ªØ li·ªáu Nh√¢n s·ª±)"]
            PDB2["PDB_SALES <br> (Ch·ª©a d·ªØ li·ªáu Kinh doanh)"]
            PDB_SEED["PDB#36;SEED <br> (Khu√¥n m·∫´u)"]
        end
        CDB --> PDB1
        CDB --> PDB2
        CDB --> PDB_SEED
    end
    %% ƒê·ªãnh nghƒ©a c√°c class m√†u s·∫Øc
    classDef rootDB fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#FFFFFF
    classDef hrDB fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#FFFFFF
    classDef salesDB fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#FFFFFF
    classDef seedDB fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#FFFFFF
    %% √Åp d·ª•ng m√†u cho c√°c node
    class CDB rootDB
    class PDB1 hrDB
    class PDB2 salesDB
    class PDB_SEED seedDB
```

**Gi·∫£i th√≠ch s∆° ƒë·ªì:**
- **Container Database (CDB):** Qu·∫£n l√Ω t√†i nguy√™n chung (metadata, users chung).
- **Pluggable Database (PDB):** C√°c c∆° s·ªü d·ªØ li·ªáu ƒë·ªôc l·∫≠p ch·ª©a d·ªØ li·ªáu ·ª©ng d·ª•ng, c√≥ th·ªÉ "c·∫Øm" v√†o ho·∫∑c r√∫t ra kh·ªèi CDB m·ªôt c√°ch d·ªÖ d√†ng.
- **PDB_SEED:** B·∫£n m·∫´u ƒë·ªÉ t·∫°o PDB m·ªõi nhanh ch√≥ng.

**V√≠ d·ª• th·ª±c t·∫ø:** ƒê·ªÉ t·∫°o m·ªôt PDB m·ªõi, s·ª≠ d·ª•ng l·ªánh:
```sql
CREATE PLUGGABLE DATABASE PDB_NEW FROM PDB_SEED;
ALTER PLUGGABLE DATABASE PDB_NEW OPEN;
```
Qu√° tr√¨nh n√†y ch·ªâ m·∫•t v√†i ph√∫t, thay v√¨ c√†i ƒë·∫∑t c∆° s·ªü d·ªØ li·ªáu m·ªõi t·ª´ ƒë·∫ßu.

**1.3 K·∫øt H·ª£p RAC V·ªõi Multitenant**

Khi k·∫øt h·ª£p Oracle RAC v·ªõi ki·∫øn tr√∫c Multitenant, ch√∫ng ta c√≥ ƒë∆∞·ª£c m·ªôt h·ªá th·ªëng v·ª´a c√≥ t√≠nh s·∫µn s√†ng cao, v·ª´a t·ªëi ∆∞u h√≥a t√†i nguy√™n h·ªá th·ªëng. ƒê√¢y l√† gi·∫£i ph√°p l√Ω t∆∞·ªüng cho c√°c doanh nghi·ªáp c·∫ßn qu·∫£n l√Ω nhi·ªÅu ·ª©ng d·ª•ng kh√°c nhau tr√™n c√πng m·ªôt n·ªÅn t·∫£ng c∆° s·ªü d·ªØ li·ªáu.

```mermaid
graph TD
    subgraph "Clients/Application"
        A[App Server 1]
        B[App Server 2]
    end
    subgraph "Oracle RAC Cluster"
        N1[Node 1: Oracle Instance]
        N2[Node 2: Oracle Instance]
    end
    SS[Shared Storage <br> ASM Disks]
    A --> N1
    B --> N2
    N1 <-->|Cluster Interconnect| N2
    N1 --> SS
    N2 --> SS
    subgraph "CDB#ROOT"
        PDB1["PDB_HR <br> (Nh√¢n s·ª±)"]
        PDB2["PDB_SALES <br> (Kinh doanh)"]
        PDB_SEED["PDB#SEED"]
    end
    N1 -->|Qu·∫£n l√Ω| CDB#ROOT
    N2 -->|Qu·∫£n l√Ω| CDB#ROOT
    CDB#ROOT --> PDB1
    CDB#ROOT --> PDB2
    CDB#ROOT --> PDB_SEED
    %% Styling
    style A fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    style B fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    style N1 fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style N2 fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000
    style SS fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
    style CDB#ROOT fill:#4CAF50,stroke:#2E7D32,stroke-width:3px,color:#FFFFFF
    style PDB1 fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#FFFFFF
    style PDB2 fill:#FF9800,stroke:#E65100,stroke-width:2px,color:#FFFFFF
    style PDB_SEED fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#FFFFFF
```

**Gi·∫£i th√≠ch s∆° ƒë·ªì:**
- **CDB (Container Database)** ch·∫°y tr√™n to√†n b·ªô c·ª•m RAC, m·ªói node trong RAC ƒë·ªÅu c√≥ th·ªÉ truy c·∫≠p v√†o CDB.
- **PDB (Pluggable Database)** ƒë∆∞·ª£c chia s·∫ª gi·ªØa c√°c node RAC. M·ªôt PDB c√≥ th·ªÉ ƒë∆∞·ª£c m·ªü tr√™n t·∫•t c·∫£ c√°c node ho·∫∑c ch·ªâ tr√™n m·ªôt s·ªë node c·ª• th·ªÉ, t√πy theo c·∫•u h√¨nh.
- **Ph√¢n b·ªë t·∫£i (Load Balancing)**: Traffic ƒë·∫øn c√°c PDB ƒë∆∞·ª£c ph√¢n ph·ªëi qua c√°c node RAC, gi√∫p c√¢n b·∫±ng t·∫£i v√† tƒÉng hi·ªáu su·∫•t x·ª≠ l√Ω.
- **T√≠nh s·∫µn s√†ng cao**: N·∫øu m·ªôt node RAC g·∫∑p s·ª± c·ªë, c√°c PDB s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ph·ª•c h·ªìi tr√™n c√°c node c√≤n l·∫°i m√† kh√¥ng l√†m gi√°n ƒëo·∫°n d·ªãch v·ª•.

**L·ª£i √≠ch ch√≠nh khi k·∫øt h·ª£p RAC v√† Multitenant**

| L·ª£i √≠ch | M√¥ t·∫£ |
|---------|-------|
| **T·ªëi ∆∞u t√†i nguy√™n** | Nhi·ªÅu PDB chia s·∫ª t√†i nguy√™n c·ªßa c·ª•m RAC, gi·∫£m chi ph√≠ ph·∫ßn c·ª©ng v√† qu·∫£n l√Ω |
| **Kh·∫£ nƒÉng m·ªü r·ªông linh ho·∫°t** | D·ªÖ d√†ng m·ªü r·ªông b·∫±ng c√°ch th√™m node RAC ho·∫∑c th√™m PDB m·ªõi |
| **Ph·ª•c h·ªìi nhanh ch√≥ng** | Khi m·ªôt node g·∫∑p s·ª± c·ªë, c√°c PDB s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ph·ª•c h·ªìi tr√™n c√°c node c√≤n l·∫°i |
| **Qu·∫£n l√Ω t·∫≠p trung** | Qu·∫£n l√Ω nhi·ªÅu PDB t·ª´ m·ªôt ƒëi·ªÉm duy nh·∫•t trong khi v·∫´n ƒë·∫£m b·∫£o t√≠nh ƒë·ªôc l·∫≠p |
| **Gi·∫£m th·ªùi gian b·∫£o tr√¨** | C√≥ th·ªÉ b·∫£o tr√¨ t·ª´ng node m√† kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn to√†n b·ªô h·ªá th·ªëng |

### 2. V·∫≠n H√†nh C∆° B·∫£n Trong M√¥i Tr∆∞·ªùng RAC

#### 2.1 S·ª± Kh√°c Bi·ªát Gi·ªØa T√†i Kho·∫£n `oracle` v√† `grid`

Trong m√¥i tr∆∞·ªùng Oracle RAC, c√≥ hai t√†i kho·∫£n h·ªá th·ªëng quan tr·ªçng m√† b·∫•t k·ª≥ DBA n√†o c≈©ng c·∫ßn hi·ªÉu r√µ:

**üîë T√†i kho·∫£n `grid`**
- **Vai tr√≤**: S·ªü h·ªØu v√† qu·∫£n l√Ω **Oracle Grid Infrastructure** (ph·∫ßn h·∫° t·∫ßng c·ª•m)
- **Quy·ªÅn h·∫°n**:
  - Qu·∫£n l√Ω Clusterware (CRS - Cluster Ready Services)
  - Qu·∫£n l√Ω Automatic Storage Management (ASM)
  - Qu·∫£n l√Ω Oracle Net Listener
  - Ki·ªÉm so√°t c√°c resource c·ªßa cluster (database, service, listener)
- **Kh√¥ng c√≥ quy·ªÅn** truy c·∫≠p v√†o d·ªØ li·ªáu trong database
- **M·ª•c ƒë√≠ch ch√≠nh**: ƒê·∫£m b·∫£o h·∫° t·∫ßng c·ª•m ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh, s·∫µn s√†ng cao

**üóÑÔ∏è T√†i kho·∫£n `oracle`**
- **Vai tr√≤**: S·ªü h·ªØu v√† qu·∫£n l√Ω **Oracle Database software**
- **Quy·ªÅn h·∫°n**:
  - Qu·∫£n l√Ω c√°c instance database
  - Th·ª±c thi c√°c l·ªánh SQL/PLSQL
  - Qu·∫£n l√Ω PDBs trong ki·∫øn tr√∫c Multitenant
  - Th·ª±c hi·ªán backup/restore (qua RMAN)
  - Qu·∫£n l√Ω schema, user, quy·ªÅn h·∫°n trong database
- **Kh√¥ng c√≥ quy·ªÅn** qu·∫£n l√Ω c√°c resource c·ªßa cluster
- **M·ª•c ƒë√≠ch ch√≠nh**: ƒê·∫£m b·∫£o database ho·∫°t ƒë·ªông v√† d·ªØ li·ªáu ƒë∆∞·ª£c qu·∫£n l√Ω ƒë√∫ng c√°ch

#### 2.2 C√°c C√¢u L·ªánh V·∫≠n H√†nh Ch√≠nh v√† T√¨nh Hu·ªëng S·ª≠ D·ª•ng

**‚úÖ C√¢u l·ªánh 1: Ki·ªÉm tra tr·∫°ng th√°i PDBs**

```
su - oracle
sqlplus / as sysdba
show pdbs  -- ki·ªÉm tra tr·∫°ng th√°i c√°c Pluggable Database (PDBs)
```

- **T·∫°i sao d√πng `oracle`?** V√¨ ƒë√¢y l√† thao t√°c tr·ª±c ti·∫øp tr√™n database, y√™u c·∫ßu quy·ªÅn qu·∫£n tr·ªã database
- **M·ª•c ƒë√≠ch**: Ki·ªÉm tra tr·∫°ng th√°i open/read-write c·ªßa c√°c PDB
- **T√¨nh hu·ªëng s·ª≠ d·ª•ng th·ª±c t·∫ø**:
  - ·ª®ng d·ª•ng b√°o l·ªói "ORA-01033: ORACLE initialization or shutdown in progress"
  - Ki·ªÉm tra routine h√†ng ng√†y ƒë·ªÉ ƒë·∫£m b·∫£o t·∫•t c·∫£ PDBs ƒëang ho·∫°t ƒë·ªông
  - Sau khi kh·ªüi ƒë·ªông l·∫°i h·ªá th·ªëng, x√°c minh xem c√°c PDBs ƒë√£ t·ª± ƒë·ªông m·ªü ch∆∞a
- **Ph√¢n t√≠ch k·∫øt qu·∫£**:
  - N·∫øu PDB ·ªü tr·∫°ng th√°i `MOUNT`: C·∫ßn m·ªü PDB (s·ª≠ d·ª•ng C√¢u l·ªánh 4)
  - N·∫øu PDB ·ªü tr·∫°ng th√°i `READ ONLY`: ·ª®ng d·ª•ng kh√¥ng th·ªÉ ghi d·ªØ li·ªáu
  - N·∫øu PDB kh√¥ng hi·ªÉn th·ªã: C√≥ th·ªÉ ch∆∞a ƒë∆∞·ª£c c·∫Øm v√†o CDB

**‚úÖ C√¢u l·ªánh 2: Ki·ªÉm tra tr·∫°ng th√°i cluster**

```
su - grid
crsctl stat res -t   -- ki·ªÉm tra tr·∫°ng th√°i c√°c resource trong cluster
lsnrctl status       -- ki·ªÉm tra listener c√≥ ƒëang ho·∫°t ƒë·ªông hay kh√¥ng
```

- **T·∫°i sao d√πng `grid`?** V√¨ ƒë√¢y l√† thao t√°c qu·∫£n l√Ω h·∫° t·∫ßng c·ª•m, kh√¥ng li√™n quan tr·ª±c ti·∫øp ƒë·∫øn d·ªØ li·ªáu
- **M·ª•c ƒë√≠ch**: D√πng khi c√¢u l·ªánh 1 cho th·∫•y PDB ch∆∞a ·ªü tr·∫°ng th√°i open
- **T√¨nh hu·ªëng s·ª≠ d·ª•ng th·ª±c t·∫ø**:
  - Khi kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn database d√π ƒë√£ th·ª≠ nhi·ªÅu c√°ch
  - Khi nghi ng·ªù m·ªôt node trong RAC ƒë√£ b·ªã down
  - Khi th·ª±c hi·ªán b·∫£o tr√¨ cluster
- **Ph√¢n t√≠ch k·∫øt qu·∫£**:
  - N·∫øu resource database ·ªü tr·∫°ng th√°i `OFFLINE`: C·∫ßn kh·ªüi ƒë·ªông database (C√¢u l·ªánh 3)
  - N·∫øu listener ·ªü tr·∫°ng th√°i `BLOCKED` ho·∫∑c kh√¥ng hi·ªÉn th·ªã: C·∫ßn kh·ªüi ƒë·ªông l·∫°i listener
  - N·∫øu c√≥ resource ·ªü tr·∫°ng th√°i `UNKNOWN`: C√≥ v·∫•n ƒë·ªÅ nghi√™m tr·ªçng v·ªõi cluster

**‚úÖ C√¢u l·ªánh 3: Kh·ªüi ƒë·ªông database**

```
su - oracle
sqlplus / as sysdba
startup
```

- **T·∫°i sao d√πng `oracle`?** V√¨ ƒë√¢y l√† thao t√°c kh·ªüi ƒë·ªông instance database
- **M·ª•c ƒë√≠ch**: D√πng ƒë·ªÉ kh·ªüi ƒë·ªông database
- **T√¨nh hu·ªëng s·ª≠ d·ª•ng th·ª±c t·∫ø**:
  - Sau khi b·∫£o tr√¨ ph·∫ßn c·ª©ng/m·∫°ng, c·∫ßn kh·ªüi ƒë·ªông l·∫°i database
  - Khi x√°c nh·∫≠n t·ª´ c√¢u l·ªánh 2 r·∫±ng cluster ho·∫°t ƒë·ªông nh∆∞ng database resource ·ªü tr·∫°ng th√°i OFFLINE
  - Khi database b·ªã shutdown do l·ªói ho·∫∑c b·∫£o tr√¨
- **L∆∞u √Ω quan tr·ªçng**:
  - **Ch·ªâ n√™n s·ª≠ d·ª•ng sau khi ki·ªÉm tra b·∫±ng c√¢u l·ªánh 1 v√† 2**, ƒë·∫£m b·∫£o cluster ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
  - **Kh√¥ng bao gi·ªù** ch·∫°y l·ªánh n√†y n·∫øu c√¢u l·ªánh 2 cho th·∫•y cluster kh√¥ng ·ªïn ƒë·ªãnh
  - N·∫øu kh·ªüi ƒë·ªông kh√¥ng th√†nh c√¥ng, c·∫ßn ki·ªÉm tra file alert.log ƒë·ªÉ x√°c ƒë·ªãnh nguy√™n nh√¢n

**‚úÖ C√¢u l·ªánh 4: M·ªü PDB**

```
alter pluggable database <t√™n_pdb> open;
```

- **T·∫°i sao d√πng `oracle`?** V√¨ ƒë√¢y l√† thao t√°c qu·∫£n tr·ªã database
- **M·ª•c ƒë√≠ch**: D√πng khi c√¢u l·ªánh `show pdbs` cho th·∫•y m·ªôt PDB ƒëang ·ªü **mode: MOUNT**
- **T√¨nh hu·ªëng s·ª≠ d·ª•ng th·ª±c t·∫ø**:
  - Sau khi kh·ªüi ƒë·ªông CDB, c√°c PDB kh√¥ng t·ª± ƒë·ªông m·ªü (t√πy c·∫•u h√¨nh)
  - Khi PDB b·ªã shutdown ƒë·ªÉ b·∫£o tr√¨ v√† c·∫ßn m·ªü l·∫°i
  - Khi PDB chuy·ªÉn sang tr·∫°ng th√°i MOUNT do l·ªói
- **L∆∞u √Ω quan tr·ªçng**:
  - C√≥ th·ªÉ m·ªü t·∫•t c·∫£ PDB c√πng l√∫c v·ªõi l·ªánh: `alter pluggable database all open;`
  - N·∫øu PDB kh√¥ng m·ªü ƒë∆∞·ª£c, c·∫ßn ki·ªÉm tra v·ªõi: `SELECT name, cause, message FROM v$pdbs_alert;`

#### 2.3 Quy Tr√¨nh X·ª≠ L√Ω S·ª± C·ªë Ti√™u Chu·∫©n

Khi g·∫∑p v·∫•n ƒë·ªÅ k·∫øt n·ªëi database, h√£y tu√¢n theo quy tr√¨nh sau:

1. **B∆∞·ªõc 1**: S·ª≠ d·ª•ng c√¢u l·ªánh 1 ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i PDBs
   - N·∫øu PDBs OPEN ‚Üí V·∫•n ƒë·ªÅ ·ªü ·ª©ng d·ª•ng ho·∫∑c network
   - N·∫øu PDBs kh√¥ng OPEN ‚Üí Chuy·ªÉn sang b∆∞·ªõc 2

2. **B∆∞·ªõc 2**: S·ª≠ d·ª•ng c√¢u l·ªánh 2 ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i cluster
   - N·∫øu cluster ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng ‚Üí Chuy·ªÉn sang b∆∞·ªõc 3
   - N·∫øu cluster c√≥ v·∫•n ƒë·ªÅ ‚Üí C·∫ßn kh·∫Øc ph·ª•c s·ª± c·ªë cluster tr∆∞·ªõc

3. **B∆∞·ªõc 3**: N·∫øu database ch∆∞a ƒë∆∞·ª£c kh·ªüi ƒë·ªông (OFFLINE) ‚Üí S·ª≠ d·ª•ng c√¢u l·ªánh 3

4. **B∆∞·ªõc 4**: Sau khi database ƒë√£ ch·∫°y ‚Üí S·ª≠ d·ª•ng c√¢u l·ªánh 4 ƒë·ªÉ m·ªü PDB

**V√≠ D·ª• Th·ª±c T·∫ø**

**T√¨nh hu·ªëng**: ·ª®ng d·ª•ng kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c ƒë·∫øn PDB_SALES

**Quy tr√¨nh x·ª≠ l√Ω**:
1. Ch·∫°y c√¢u l·ªánh 1:
   ```
   su - oracle
   sqlplus / as sysdba
   show pdbs
   ```
   ‚Üí K·∫øt qu·∫£: PDB_SALES ·ªü tr·∫°ng th√°i MOUNT

2. Ch·∫°y c√¢u l·ªánh 2:
   ```
   su - grid
   crsctl stat res -t
   ```
   ‚Üí K·∫øt qu·∫£: T·∫•t c·∫£ resource ONLINE

3. V√¨ cluster ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng nh∆∞ng PDB_SALES ch∆∞a m·ªü:
   ```
   su - oracle
   sqlplus / as sysdba
   alter pluggable database PDB_SALES open;
   ```

4. Ki·ªÉm tra l·∫°i b·∫±ng c√¢u l·ªánh 1 ƒë·ªÉ x√°c nh·∫≠n PDB_SALES ƒë√£ ·ªü tr·∫°ng th√°i OPEN

#### 2.4 Quy Tr√¨nh Kh·ªüi ƒê·ªông (Startup) M·ªôt C∆° S·ªü D·ªØ Li·ªáu RAC

```mermaid
flowchart TD
    A[B·∫Øt ƒë·∫ßu] --> B{ƒêƒÉng nh·∫≠p v√†o server};
    B --> C[su - grid <br/> <i>Chuy·ªÉn sang user 'grid'</i>];
    C --> D[crsctl stat res -t <br/> <i>Ki·ªÉm tra tr·∫°ng th√°i Clusterware</i>];
    D --> E{Cluster ƒë√£ ch·∫°y ch∆∞a?};
    E --Ch∆∞a--> F[crsctl start cluster <br/> <i>Kh·ªüi ƒë·ªông Clusterware</i>];
    E --R·ªìi--> G[su - oracle <br/> <i>Chuy·ªÉn sang user 'oracle'</i>];
    F --> G;
    G --> H[sqlplus / as sysdba <br/> <i>K·∫øt n·ªëi v√†o SQL*Plus</i>];
    H --> I[startup <br/> <i>Kh·ªüi ƒë·ªông Database Instance</i>];
    I --> J{PDB ƒë√£ m·ªü ch∆∞a?};
    J --Ch∆∞a--> K[alter pluggable database <br/> T√äN_PDB open;];
    K --> L[K·∫øt th√∫c];
    J --R·ªìi--> L;
    %% ƒê·ªãnh nghƒ©a c√°c class m√†u s·∫Øc
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef gridUser fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef oracleUser fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef clusterOps fill:#fff8e1,stroke:#f57f17,stroke-width:2px,color:#000
    classDef dbOps fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef pdbOps fill:#e0f2f1,stroke:#00695c,stroke-width:2px,color:#000
    %% √Åp d·ª•ng m√†u s·∫Øc
    class A,L startEnd
    class B,E,J decision
    class C,D gridUser
    class G,H oracleUser
    class F clusterOps
    class I dbOps
    class K pdbOps
```

**L·ªánh th·ª±c t·∫ø:**

| B∆∞·ªõc | L·ªánh | M√¥ t·∫£ |
|------|------|-------|
| Ki·ªÉm tra tr·∫°ng th√°i cluster | `crsctl stat res -t` | Xem t·∫•t c·∫£ resource c√≥ ƒëang ONLINE kh√¥ng |
| Kh·ªüi ƒë·ªông cluster | `crsctl start cluster -all` | Ch·ªâ d√πng khi cluster ch∆∞a ch·∫°y |
| ƒêƒÉng nh·∫≠p v√†o DB | `sqlplus / as sysdba` | K·∫øt n·ªëi v·ªõi quy·ªÅn cao nh·∫•t |
| Xem tr·∫°ng th√°i PDB | `show pdbs` | Ki·ªÉm tra PDB n√†o ch∆∞a m·ªü |
| M·ªü t·∫•t c·∫£ PDB | `alter pluggable database all open` | B·∫Øt bu·ªôc sau khi kh·ªüi ƒë·ªông CDB |

**X·ª≠ L√Ω L·ªói Th∆∞·ªùng G·∫∑p:**
- **Kh√¥ng kh·ªüi ƒë·ªông ƒë∆∞·ª£c Clusterware:** S·ª≠ d·ª•ng `crsctl check cluster -all`. N·∫øu l·ªói CRS-4535, ch·∫°y `crsctl start cluster -all`.
- **PDB kh√¥ng m·ªü ƒë∆∞·ª£c:** Ki·ªÉm tra v·ªõi `SELECT name, open_mode, total_size/1024/1024 "Size (MB)" FROM v$pdbs;`. M·ªü l·ª±c l∆∞·ª£ng n·∫øu c·∫ßn: `ALTER PLUGGABLE DATABASE PDB_HR OPEN FORCE;`.
- **Diskgroup ASM ƒë·∫ßy:** Ki·ªÉm tra `SELECT name, total_mb, free_mb, (free_mb/total_mb)*100 "FREE%" FROM v$asm_diskgroup;`. Th√™m ƒëƒ©a: `ALTER DISKGROUP DATA ADD DISK '/dev/sdx1';`.

### 3. Gi√°m S√°t V√† Ch·∫©n ƒêo√°n Hi·ªáu NƒÉng

**Quy Tr√¨nh Ch·∫©n ƒêo√°n M·ªôt V·∫•n ƒê·ªÅ V·ªÅ Hi·ªáu NƒÉng**

Lu√¥n ki·ªÉm tra theo th·ª© t·ª±: OS ‚Üí Storage ‚Üí Database ƒë·ªÉ ti·∫øt ki·ªám th·ªùi gian.

```mermaid
flowchart TD
    Start[Ph√°t hi·ªán h·ªá th·ªëng ch·∫≠m] --> L1{"L·ªõp 1: Ki·ªÉm tra OS"};
    L1 --"OK"--> L2{"L·ªõp 2: Ki·ªÉm tra Storage (ASM)"};
    L1 --"Co van de"--> FixOS["X·ª≠ l√Ω v·∫•n ƒë·ªÅ OS <br/> (CPU/RAM cao, I/O wait)"];
    L2 --"OK"--> L3{"L·ªõp 3: Ki·ªÉm tra Database"};
    L2 --"Co van de"--> FixASM["X·ª≠ l√Ω v·∫•n ƒë·ªÅ Storage <br/> (Disk group ƒë·∫ßy, l·ªói disk)"];
    L3 --> S1["<b>B∆∞·ªõc 1:</b> T√¨m session 'ACTIVE' <br/> <i>(d√πng gv$session)</i>"];
    S1 --> S2["L·∫•y ra <b>sql_id</b> v√† <b>last_call_et</b>"];
    S2 --> S3["<b>B∆∞·ªõc 2:</b> T√¨m n·ªôi dung c√¢u l·ªánh <br/> <i>(d√πng gv$sqlarea v·ªõi sql_id)</i>"];
    S3 --> End["T·ªëi ∆∞u c√¢u l·ªánh SQL <br/> (Th√™m index, vi·∫øt l·∫°i logic...)"]
    subgraph OSCommands ["C√°c l·ªánh ki·ªÉm tra OS"]
        direction LR
        top[top]
        free[free -g]
        iostat[iostat]
    end
    L1 --> OSCommands
    subgraph DBCommands ["C√°c l·ªánh ki·ªÉm tra DB"]
        direction LR
        q1[select ... from gv$session]
        q2[select ... from gv$sqlarea]
    end
    L3 --> DBCommands
    %% ƒê·ªãnh nghƒ©a c√°c class m√†u s·∫Øc
    classDef startNode fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
    classDef checkNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef fixNode fill:#ffebee,stroke:#b71c1c,stroke-width:2px,color:#000
    classDef processNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
    classDef endNode fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    classDef commandNode fill:#f1f8e9,stroke:#33691e,stroke-width:1px,color:#000
    classDef subgraphStyle fill:#fafafa,stroke:#757575,stroke-width:2px
    %% √Åp d·ª•ng class cho c√°c node
    class Start startNode
    class L1,L2,L3 checkNode
    class FixOS,FixASM fixNode
    class S1,S2,S3 processNode
    class End endNode
    class top,free,iostat,q1,q2 commandNode
```

**C√¥ng C·ª• Ki·ªÉm Tra Nhanh:**

| L·ªõp | C√¥ng c·ª• | Ch·ªâ s·ªë c·∫ßn quan t√¢m | M·ª©c nguy hi·ªÉm |
|-----|---------|---------------------|---------------|
| OS | `top` | %CPU, %MEM, load average | >80% li√™n t·ª•c |
| OS | `free -g` | available memory | <10% total |
| Storage | `iostat 2 5` | %util, await | %util >90% |
| ASM | `v$asm_diskgroup` | free_mb/total_mb | <10% free |
| DB | `gv$session` | last_call_et, status | >300s |

**C√°c C√¢u L·ªánh SQL Ch·∫©n ƒêo√°n:**

1. **T√¨m session ƒëang ch·∫°y l√¢u v√† l·∫•y `sql_id`:**
   ```sql
   SELECT sid, serial#, username, machine,
          sql_id, last_call_et/60 "Ph√∫t"
   FROM gv$session
   WHERE status = 'ACTIVE'
     AND type != 'BACKGROUND'
     AND last_call_et > 300
   ORDER BY last_call_et DESC;
   ```

2. **L·∫•y n·ªôi dung c√¢u l·ªánh SQL t·ª´ `sql_id`:**
   ```sql
   SELECT sql_fulltext
   FROM gv$sqlarea
   WHERE sql_id = ':your_sql_id';
   ```

## Ph·∫ßn II: MongoDB

### 1. Ki·∫øn Tr√∫c Sharding (Ph√¢n M·∫£nh)

Sharding ph√¢n t√°n d·ªØ li·ªáu ra nhi·ªÅu m√°y ch·ªß ƒë·ªÉ x·ª≠ l√Ω kh·ªëi l∆∞·ª£ng l·ªõn, c·∫£i thi·ªán t·ªëc ƒë·ªô v√† ƒë·ªô s·∫µn s√†ng.

```mermaid
graph TD
    App["·ª®ng d·ª•ng"] --> Mongos["Mongos Router"];
    subgraph "Metadata"
        Config["Config Servers<br/>(L∆∞u c·∫•u h√¨nh Sharding)"]
    end
    subgraph "Data Storage"
        Shard1["Shard 1<br/>(Replica Set)"]
        Shard2["Shard 2<br/>(Replica Set)"]
        Shard3["Shard 3<br/>(Replica Set)"]
    end
    Mongos -- "Truy v·∫•n & ghi d·ªØ li·ªáu" --> Shard1;
    Mongos -- "Truy v·∫•n & ghi d·ªØ li·ªáu" --> Shard2;
    Mongos -- "Truy v·∫•n & ghi d·ªØ li·ªáu" --> Shard3;
    Mongos -- "ƒê·ªçc metadata" --> Config;
    %% Styling v·ªõi nhi·ªÅu m√†u s·∫Øc
    style App fill:#FF6B6B,stroke:#FF4757,stroke-width:3px,color:#fff
    style Mongos fill:#4ECDC4,stroke:#26D0CE,stroke-width:3px,color:#fff
    style Config fill:#FFE66D,stroke:#FFD93D,stroke-width:3px,color:#333
    style Shard1 fill:#A8E6CF,stroke:#7FCDCD,stroke-width:2px,color:#333
    style Shard2 fill:#88D8C0,stroke:#52C7B8,stroke-width:2px,color:#333
    style Shard3 fill:#6FCF97,stroke:#27AE60,stroke-width:2px,color:#333
    %% Styling cho subgraph
    classDef metadataGroup fill:#FFF5B4,stroke:#F39C12,stroke-width:2px
    classDef storageGroup fill:#E8F8F5,stroke:#16A085,stroke-width:2px
```

**Gi·∫£i th√≠ch s∆° ƒë·ªì:**
- **·ª®ng d·ª•ng:** K·∫øt n·ªëi qua Mongos.
- **Mongos (Router):** ƒê·ªãnh tuy·∫øn truy v·∫•n d·ª±a tr√™n metadata t·ª´ Config Servers.
- **Config Servers:** L∆∞u b·∫£n ƒë·ªì d·ªØ li·ªáu (√≠t nh·∫•t 3 server cho production).
- **Shards:** C√°c replica set l∆∞u tr·ªØ d·ªØ li·ªáu ph√¢n m·∫£nh.

**Replica Set Trong Shard:** M·ªói shard l√† m·ªôt replica set v·ªõi primary (x·ª≠ l√Ω write) v√† secondary (sao ch√©p d·ªØ li·ªáu, h·ªó tr·ª£ read). C∆° ch·∫ø failover t·ª± ƒë·ªông khi primary th·∫•t b·∫°i.

### 2. V·∫≠n H√†nh V√† Gi√°m S√°t

#### 1. Quy Tr√¨nh Import D·ªØ Li·ªáu V√†o Sharded Cluster

```mermaid
flowchart TD
    Client["Client/Tool (mongoimport, Studio 3T...)"]
    subgraph "ƒê√öNG"
        direction LR
        R1[Client] --> R2[Mongos] --> R3["C√°c Shard (Mongos t·ª± ƒëi·ªÅu ph·ªëi)"]
    end
    subgraph "SAI"
        direction LR
        W1[Client] --> W2["K·∫øt n·ªëi tr·ª±c ti·∫øp v√†o Shard 1"]
    end
    Client -- N√™n l√†m --> R1
    Client -- Kh√¥ng n√™n l√†m --> W1
    style R2 fill:#9f9
    style W2 fill:#f66
```

**L∆∞u √Ω quan tr·ªçng:** Lu√¥n import qua Mongos ƒë·ªÉ tr√°nh m·∫•t c√¢n b·∫±ng d·ªØ li·ªáu. V√≠ d·ª• l·ªánh ƒë√∫ng:
```bash
mongoimport --host mongos-host:27017 --db mydb --collection users --file data.json --numInsertionWorkers 8
```

#### 2. Gi√°m S√°t V·ªõi MongoDB Compass

K·∫øt n·ªëi Compass ƒë·∫øn Mongos, v√†o tab Performance ƒë·ªÉ xem Slowest Operations.

**Ch·ªâ S·ªë C·∫ßn Quan T√¢m:**

| Ch·ªâ s·ªë | √ù nghƒ©a | M·ª©c c·∫£nh b√°o |
|--------|---------|--------------|
| Execution Time | Th·ªùi gian ch·∫°y truy v·∫•n | >500ms |
| Docs Examined | S·ªë document qu√©t | Cao h∆°n nReturned nhi·ªÅu l·∫ßn |
| nReturned | S·ªë document tr·∫£ v·ªÅ | - |
| Index Used | C√≥ d√πng index kh√¥ng | N√™n lu√¥n l√† YES |
| Shard Targeting | S·ªë shard ƒë∆∞·ª£c truy v·∫•n | C√†ng √≠t c√†ng t·ªët |

**C√°ch t·ªëi ∆∞u:** T·∫°o index (`db.users.createIndex({email: 1})`) v√† s·ª≠ d·ª•ng projection.

## Ph·∫ßn III: T·ªïng k·∫øt

### Checklist H√†ng Ng√†y

**Oracle:**
- Ki·ªÉm tra tr·∫°ng th√°i RAC: `crsctl stat res -t`
- Xem free space ASM: `SELECT name, free_mb FROM v$asm_diskgroup`
- T√¨m session ch·∫°y l√¢u: `SELECT * FROM gv$session WHERE last_call_et > 300`
- Ki·ªÉm tra backup: `RMAN> LIST BACKUP SUMMARY;`

**MongoDB:**
- Tr·∫°ng th√°i cluster: `sh.status()`
- Truy v·∫•n ch·∫≠m: `db.currentOp({"secs_running": {$gt: 5}})`
- Gi√°m s√°t storage: `db.getSiblingDB('admin').runCommand({getShardMap: 1})`
- Replica set: `rs.status()`

### C√¥ng C·ª• H·ªó Tr·ª£

| C√¥ng c·ª• | Oracle | MongoDB | M√¥ t·∫£ |
|---------|--------|---------|-------|
| GUI | Toad | MongoDB Compass | D·ªÖ d√πng cho ng∆∞·ªùi m·ªõi |
| Gi√°m s√°t | OEM | MongoDB Atlas | Theo d√µi hi·ªáu nƒÉng |
| Th·ª±c h√†nh | Oracle Live SQL | MongoDB University | H·ªçc mi·ªÖn ph√≠ |
| Backup | RMAN | mongodump | Backup ti√™u chu·∫©n |