### **Mục tiêu**

Hướng dẫn này giúp bạn thiết lập một máy ảo Linux trên **VMware Workstation** với hai card mạng:

  * **NAT (Network Address Translation):** Để máy ảo có thể truy cập Internet.
  * **Host-only:** Để bạn có thể SSH từ máy thật vào máy ảo.

-----

### **Bước 1: Cấu hình card mạng trong VMware Workstation**

Đây là bước đầu tiên và rất quan trọng.

  * **Tắt máy ảo đi**. Không được cấu hình khi máy ảo đang chạy.
  * Mở **Virtual Machine Settings** của máy ảo.
  * Thêm hai **Network Adapter**.
  * Chọn **Network Adapter đầu tiên** và cấu hình là **NAT**. Card này được đặt tên là **VMnet8**.
  * Chọn **Network Adapter thứ hai** và cấu hình là **Host-only**. Card này được đặt tên là **VMnet1**.

-----

### **Bước 2: Xác định thông số mạng (trên máy thật)**

Bạn cần tìm dải IP và Gateway của mạng Host-only (VMnet1). Đây là bước quyết định để SSH thành công.

  * Mở **Virtual Network Editor** trong VMware Workstation (vào **Edit** \> **Virtual Network Editor**).
  * Cửa sổ này sẽ hiển thị tất cả các mạng ảo. Tìm và chọn **VMnet1** trong danh sách.
  * Bạn sẽ thấy **Subnet IP** (ví dụ: `192.168.71.0`) và **Subnet Mask** (ví dụ: `255.255.255.0`).
  * **Lỗi thường gặp:** Để tìm **Gateway**, đừng nhìn vào mục DHCP. Thay vào đó, hãy mở **Command Prompt** trên máy thật và gõ `ipconfig`.
  * Trong kết quả `ipconfig`, tìm mục **"VMware Network Adapter VMnet1"**. Địa chỉ **IPv4 Address** của card này chính là **Gateway** bạn cần. Ví dụ: `192.168.71.1`.

-----

### **Bước 3: Cấu hình IP tĩnh trong máy ảo Linux**

Sau khi khởi động máy ảo, bạn sẽ cấu hình IP tĩnh cho card mạng Host-only.

  * **Xác định tên card mạng:** Mở Terminal và gõ `ip a`. Bạn sẽ thấy một card mạng chưa có IP, tên thường là `ens224`.
  * **Cấu hình IP tĩnh:** Bạn có thể chọn một trong hai cách sau.

**Cách 1: Sửa file cấu hình (Có thể không hoạt động)**

  * Tạo và sửa file `/etc/sysconfig/network-scripts/ifcfg-ens224`.
  * Dán nội dung sau. Chú ý: **`IPADDR`** phải nằm trong dải `192.168.71.x` nhưng không được trùng với Gateway hoặc các IP khác đang dùng.
    ```
    BOOTPROTO=static
    IPADDR=192.168.71.x  # Thay x bằng một số chưa dùng, ví dụ 100
    NETMASK=255.255.255.0
    GATEWAY=192.168.71.y # Thay y bằng Gateway của VMnet1, thường là 1 hoặc 2
    DNS1=8.8.8.8
    ONBOOT=yes
    ```
  * **Lỗi:** Nếu bạn chỉ dùng lệnh `sudo systemctl restart NetworkManager`, card mạng có thể không nhận IP tĩnh và chuyển sang DHCP.

**Cách 2: Dùng lệnh `nmcli` (Khuyên dùng)**
Đây là cách hiệu quả nhất để tránh lỗi cấu hình file.

  * Cấu hình trực tiếp IP tĩnh vào cơ sở dữ liệu của NetworkManager.
    ```bash
    sudo nmcli con mod "ens224" ipv4.method manual ipv4.addresses 192.168.71.x/24 ipv4.gateway 192.168.71.y
    sudo nmcli con mod "ens224" ipv4.dns 8.8.8.8
    ```
  * Sau đó, kích hoạt lại card mạng.
    ```bash
    sudo nmcli con up "ens224"
    ```

Lệnh này sẽ **buộc** card mạng nhận IP tĩnh mà bạn vừa cấu hình.

-----

### **Bước 4: Kiểm tra và khắc phục sự cố SSH**

  * **Kiểm tra ping:** Từ máy thật, mở Command Prompt và gõ `ping IPADDR_vừa_đặt`. Nếu ping thành công, kết nối đã hoạt động.
  * **Kiểm tra SSH:** Dùng lệnh `ssh root@IPADDR_vừa_đặt` để đăng nhập.

**Lỗi thường gặp:** Không SSH được dù ping thành công.

  * **Khắc phục 1: Dịch vụ SSH:** Dịch vụ `sshd` có thể chưa chạy. Kiểm tra bằng `sudo systemctl status sshd`. Nếu nó không `active`, bật lên bằng `sudo systemctl start sshd`.
  * **Khắc phục 2: Tường lửa:** Tường lửa có thể chặn cổng 22. Dùng `sudo firewall-cmd --state` để kiểm tra. Nếu tường lửa đang hoạt động, cho phép dịch vụ SSH đi qua bằng lệnh `sudo firewall-cmd --permanent --add-service=ssh` và sau đó `sudo firewall-cmd --reload`.

Làm theo các bước trên, bạn sẽ thiết lập được một kết nối ổn định và hiệu quả, tránh được những lỗi mà chúng ta đã từng gặp.