# HƯỚNG DẪN CHI TIẾT CÀI ĐẶT VÀ SỬ DỤNG MONGODB TỪ A ĐẾN Z

## PHẦN 1: CHUẨN BỊ MÔI TRƯỜNG

### Bước 1: Tải và cài đặt VMware Workstation

**Tại sao cần VMware?**  
MongoDB thường được cài trên máy chủ Linux, nhưng nếu bạn đang dùng Windows/Mac, VMware sẽ giúp tạo máy ảo Linux để cài đặt MongoDB.

**Các bước thực hiện:**

1. Truy cập trang chủ VMware: https://www.vmware.com/products/workstation-player/workstation-player-evaluation.html
2. Tải phiên bản VMware Workstation Player (miễn phí cho mục đích cá nhân)
   - *Lưu ý: Phiên bản Pro có trả phí nhưng Player đủ cho mục đích học tập*
3. Chạy file cài đặt và làm theo hướng dẫn trên màn hình
   - Chấp nhận điều khoản
   - Chọn vị trí cài đặt (giữ mặc định)
   - Bỏ chọn các thành phần không cần thiết như "Check for updates"
   - Nhấn "Install" và chờ quá trình hoàn tất
4. Khởi động lại máy tính nếu được yêu cầu

*Kiểm tra xác minh:*  
- Sau khi cài đặt xong, mở VMware Workstation Player để đảm bảo chương trình chạy bình thường
- Xác minh phiên bản: Help > About VMware Workstation Player

### Bước 2: Tải file ISO Oracle Linux 7.9

**Tại sao chọn Oracle Linux 7.9?**  
Oracle Linux là một bản phân phối Linux tương thích với RHEL (Red Hat Enterprise Linux), được MongoDB hỗ trợ chính thức.

**Các bước thực hiện:**

1. Truy cập trang tải Oracle Linux: https://www.oracle.com/linux/downloads/linux7-iso.html
2. Tải file ISO "Oracle Linux Release 7 Update 9 for x86_64 (64 bit)"
   - Chọn phiên bản "Oracle Linux 7.9 for x86_64 (64 bit)"
   - File cần tải: `OracleLinux-R7-U9-Server-x86_64-dvd.iso`
3. Lưu file ISO vào thư mục dễ tìm (ví dụ: `C:\ISO\OracleLinux`)

*Xác minh tính toàn vẹn của file ISO:*  
- Tải file checksum từ trang chủ: https://www.oracle.com/linux/checksums/
- So sánh checksum với file ISO đã tải bằng công cụ như `certutil` trên Windows:
  ```
  certutil -hashfile "C:\ISO\OracleLinux\OracleLinux-R7-U9-Server-x86_64-dvd.iso" SHA256
  ```
- So sánh kết quả với giá trị trên trang chủ để đảm bảo file không bị hỏng

### Bước 3: Tạo máy ảo Oracle Linux trên VMware

**Các bước thực hiện:**

1. Mở VMware Workstation Player
2. Chọn "Create a New Virtual Machine"
3. Trong cửa sổ "New Virtual Machine Wizard":
   - Chọn "Installer disc image file (iso):" và chỉ đến file ISO đã tải
   - Nhấn "Next"
4. Nhập thông tin đăng nhập:
   - Username: oracle
   - Password: oracle123 (lưu lại để dùng sau)
   - Nhấn "Next"
5. Đặt tên máy ảo:
   - Virtual machine name: MongoDB_Server
   - Location: Chọn thư mục lưu máy ảo (ít nhất 40GB trống)
   - Nhấn "Next"
6. Chỉ định dung lượng:
   - Disk capacity: 40GB (tối thiểu)
   - Chọn "Store virtual disk as a single file"
   - Nhấn "Next"
7. Customize Hardware:
   - Memory: 4GB (tối thiểu)
   - Processors: 2 cores
   - Network Adapter: Bridged (để máy ảo có IP riêng trên mạng)
   - Nhấn "Close" sau khi cấu hình xong
8. Nhấn "Finish" để tạo máy ảo

*Kiểm tra xác minh:*  
- Khởi động máy ảo và đảm bảo hệ điều hành Oracle Linux 7.9 khởi động bình thường
- Đăng nhập bằng tài khoản đã tạo ở bước 4

### Bước 4: Cấu hình mạng và cập nhật hệ thống

**Tại sao cần cấu hình mạng?**  
Để máy ảo kết nối internet, tải các gói phần mềm cần thiết cho MongoDB.

**Các bước thực hiện:**

1. Đăng nhập vào Oracle Linux với tài khoản đã tạo
2. Mở Terminal (nhấp chuột phải trên desktop > Open Terminal)
3. Xác định tên card mạng:
   ```bash
   ip addr
   ```
   - Thông thường là `ens32` hoặc `eth0`
4. Chỉnh sửa file cấu hình mạng:
   ```bash
   sudo vi /etc/sysconfig/network-scripts/ifcfg-ens32
   ```
   *(Thay ens32 bằng tên card mạng của bạn)*
5. Sửa các thông số sau:
   ```
   BOOTPROTO=static
   ONBOOT=yes
   IPADDR=192.168.1.100  # Chọn IP phù hợp với mạng của bạn
   NETMASK=255.255.255.0
   GATEWAY=192.168.1.1
   DNS1=8.8.8.8
   DNS2=8.8.4.4
   ```
6. Lưu file và thoát (trong vi: nhấn ESC > :wq > Enter)
7. Khởi động lại dịch vụ mạng:
   ```bash
   sudo systemctl restart network
   ```
8. Kiểm tra kết nối internet:
   ```bash
   ping google.com
   ```
   - Nếu có phản hồi, bạn đã kết nối internet thành công
9. Cập nhật hệ thống:
   ```bash
   sudo yum update -y
   ```

*Xác minh:*  
- Chạy lệnh `ip addr show ens32` để kiểm tra IP đã được gán đúng
- Chạy `ping 8.8.8.8` để kiểm tra kết nối mạng cơ bản

## PHẦN 2: CÀI ĐẶT VÀ CẤU HÌNH MONGODB

### Bước 5: Tắt SELinux

**Tại sao cần tắt SELinux?**  
SELinux (Security-Enhanced Linux) có thể gây xung đột với MongoDB do các chính sách bảo mật nghiêm ngặt. Tắt SELinux giúp MongoDB hoạt động ổn định hơn.

**Các bước thực hiện:**

1. Mở file cấu hình SELinux:
   ```bash
   sudo vi /etc/selinux/config
   ```
2. Tìm dòng `SELINUX=enforcing` và thay bằng:
   ```
   SELINUX=disabled
   ```
3. Lưu file và thoát
4. Khởi động lại máy ảo:
   ```bash
   sudo reboot
   ```
5. Sau khi khởi động lại, kiểm tra trạng thái SELinux:
   ```bash
   sestatus
   ```
   - Kết quả phải hiển thị `SELinux status: disabled`

*Thay thế an toàn:*  
Nếu không muốn tắt SELinux hoàn toàn, có thể cấu hình các chính sách riêng cho MongoDB, nhưng với người mới, tắt SELinux là cách đơn giản nhất.

### Bước 6: Tắt firewalld

**Tại sao cần tắt firewalld?**  
Firewalld có thể chặn cổng 27017 (cổng mặc định của MongoDB), gây khó khăn cho việc kết nối.

**Các bước thực hiện:**

1. Dừng firewalld:
   ```bash
   sudo systemctl stop firewalld
   ```
2. Vô hiệu hóa firewalld để không khởi động cùng hệ thống:
   ```bash
   sudo systemctl disable firewalld
   ```
3. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status firewalld
   ```
   - Kết quả phải hiển thị "Active: inactive (dead)"

*Lưu ý bảo mật:*  
Trong môi trường production, bạn nên cấu hình firewalld để chỉ mở cổng 27017 cho các IP được phép kết nối thay vì tắt hoàn toàn.

### Bước 7: Cấu hình tham số kernel cho MongoDB

**Tại sao cần cấu hình ulimit?**  
MongoDB yêu cầu giới hạn tài nguyên hệ thống cao hơn mặc định để hoạt động ổn định, đặc biệt là số lượng file mở tối đa và số tiến trình.

**Các bước thực hiện:**

1. Tạo file cấu hình ulimit:
   ```bash
   sudo vi /etc/security/limits.d/99-mongodb-nproc.conf
   ```
2. Thêm các dòng sau vào file:
   ```
   mongod soft nofile 64000
   mongod hard nofile 64000
   root soft nofile 64000
   root hard nofile 64000
   
   mongod hard memlock unlimited
   mongod soft memlock unlimited
   root hard memlock unlimited
   root soft memlock unlimited
   
   mongod soft data unlimited
   mongod hard data unlimited
   root soft data unlimited
   root hard data unlimited
   
   mongod soft nproc 64000
   mongod hard nproc 64000
   root soft nproc 64000
   root hard nproc 64000
   ```
3. Lưu file và thoát
4. Cấu hình sysctl:
   ```bash
   sudo vi /etc/sysctl.conf
   ```
5. Thêm các dòng sau vào cuối file:
   ```
   fs.file-max = 6815744
   kernel.pid_max = 64000
   kernel.threads-max = 64000
   vm.swappiness = 1
   net.ipv4.ip_local_port_range = 1024 65530
   vm.max_map_count = 9999999
   net.ipv4.tcp_keepalive_time = 120
   ```
6. Áp dụng các thay đổi:
   ```bash
   sudo sysctl -p
   ```

*Xác minh:*  
- Kiểm tra giới hạn file: `ulimit -n` (phải trả về 64000)
- Kiểm tra giới hạn tiến trình: `ulimit -u` (phải trả về 64000)

### Bước 8: Tắt Transparent Huge Pages (THP)

**Tại sao cần tắt THP?**  
Transparent Huge Pages có thể gây hiệu năng không ổn định cho MongoDB do cách quản lý bộ nhớ.

**Các bước thực hiện:**

1. Tạo file service để tắt THP:
   ```bash
   sudo vi /etc/systemd/system/disable-transparent-huge-pages.service
   ```
2. Thêm nội dung sau:
   ```
   [Unit]
   Description=Disable Transparent Huge Pages (THP)
   DefaultDependencies=no
   After=sysinit.target local-fs.target
   Before=mongod.service
   
   [Service]
   Type=oneshot
   ExecStart=/bin/sh -c 'echo never | tee /sys/kernel/mm/transparent_hugepage/enabled > /dev/null'
   
   [Install]
   WantedBy=basic.target
   ```
3. Lưu file và thoát
4. Kích hoạt service:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl start disable-transparent-huge-pages
   sudo systemctl enable disable-transparent-huge-pages
   ```
5. Kiểm tra trạng thái:
   ```bash
   cat /sys/kernel/mm/transparent_hugepage/enabled
   ```
   - Kết quả phải hiển thị `[never] madvise always`

*Xác minh:*  
- Chạy lệnh `cat /sys/kernel/mm/transparent_hugepage/enabled` sau khi khởi động lại để đảm bảo THP vẫn bị tắt

### Bước 9: Cài đặt MongoDB Community Edition 7.0.14

**Tại sao chọn phiên bản 7.0.14?**  
Đây là phiên bản mới nhất (theo tài liệu) với các tính năng và sửa lỗi mới nhất.

**Các bước thực hiện:**

1. Tạo file repo cho MongoDB:
   ```bash
   sudo vi /etc/yum.repos.d/mongodb-enterprise-7.0.repo
   ```
2. Thêm nội dung sau:
   ```
   [mongodb-enterprise-7.0]
   name=MongoDB Enterprise Repository
   baseurl=https://repo.mongodb.com/yum/redhat/7/mongodb-enterprise/7.0/$basearch/
   gpgcheck=1
   enabled=1
   gpgkey=https://pgp.mongodb.com/server-7.0.asc
   ```
3. Lưu file và thoát
4. Import GPG key:
   ```bash
   sudo rpm --import https://pgp.mongodb.com/server-7.0.asc
   ```
5. Cài đặt MongoDB:
   ```bash
   sudo yum install -y mongodb-enterprise-7.0.14 mongodb-enterprise-database-7.0.14 mongodb-enterprise-server-7.0.14 mongodb-mongosh-7.0.14 mongodb-enterprise-mongos-7.0.14 mongodb-enterprise-tools-7.0.14
   ```
6. Kiểm tra phiên bản đã cài:
   ```bash
   mongod --version
   ```

*Xác minh:*  
- Chạy `which mongod` để kiểm tra đường dẫn cài đặt
- Chạy `mongod --version` để xem phiên bản chính xác

### Bước 10: Cấu hình thư mục dữ liệu và quyền

**Tại sao cần cấu hình thư mục dữ liệu riêng?**  
Để dễ quản lý và đảm bảo MongoDB có quyền truy cập vào thư mục lưu trữ dữ liệu.

**Các bước thực hiện:**

1. Tạo thư mục lưu dữ liệu:
   ```bash
   sudo mkdir -p /data/datafile
   ```
2. Đặt quyền sở hữu cho user mongod:
   ```bash
   sudo chown -R mongod:mongod /data/datafile
   ```
3. Kiểm tra quyền:
   ```bash
   ls -ld /data/datafile
   ```
   - Kết quả phải hiển thị `drwxr-xr-x. 2 mongod mongod 6 Thg 6 10 14:30 /data/datafile`

*Xác minh:*  
- Đảm bảo thư mục tồn tại và có quyền đúng: `stat /data/datafile`

### Bước 11: Cấu hình file mongod.conf

**Tại sao cần chỉnh sửa file cấu hình?**  
File cấu hình mongod.conf xác định cách MongoDB hoạt động, bao gồm vị trí lưu dữ liệu, cổng kết nối, và các tham số khác.

**Các bước thực hiện:**

1. Mở file cấu hình:
   ```bash
   sudo vi /etc/mongod.conf
   ```
2. Tìm và sửa section `storage`:
   ```yaml
   storage:
     dbPath: /data/datafile
   ```
3. Tìm và sửa section `net`:
   ```yaml
   net:
     port: 27017
     bindIp: 0.0.0.0
   ```
   - `bindIp: 0.0.0.0` cho phép kết nối từ mọi địa chỉ IP (chỉ dùng cho môi trường test)
4. Lưu file và thoát

*Lưu ý bảo mật:*  
Trong môi trường production, bạn nên giới hạn `bindIp` chỉ cho các IP cụ thể được phép kết nối.

### Bước 12: Tạo keyfile cho xác thực

**Tại sao cần keyfile?**  
Keyfile được sử dụng để xác thực giữa các thành phần của MongoDB trong môi trường production.

**Các bước thực hiện:**

1. Tạo keyfile:
   ```bash
   cd /data
   sudo openssl rand -base64 756 > mongo-keyfile
   ```
2. Đặt quyền chỉ đọc cho user mongod:
   ```bash
   sudo chmod 400 mongo-keyfile
   sudo chown mongod:mongod mongo-keyfile
   ```
3. Kiểm tra quyền:
   ```bash
   ls -l /data/mongo-keyfile
   ```
   - Kết quả phải hiển thị `-r--------. 1 mongod mongod 1020 Thg 6 10 14:45 /data/mongo-keyfile`

*Xác minh:*  
- Đảm bảo nội dung keyfile không bị lộ: `cat /data/mongo-keyfile` (chỉ nên có chuỗi ký tự ngẫu nhiên)

### Bước 13: Khởi động MongoDB và tạo user admin

**Các bước thực hiện:**

1. Khởi động dịch vụ MongoDB:
   ```bash
   sudo systemctl start mongod
   ```
2. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status mongod
   ```
   - Phải hiển thị "Active: active (running)"
3. Kết nối vào MongoDB shell:
   ```bash
   mongosh
   ```
4. Trong MongoDB shell, tạo database admin và user:
   ```javascript
   use admin
   db.createUser({
     user: "mongodba",
     pwd: "123312",
     roles: [{ role: "root", db: "admin" }]
   })
   ```
5. Thoát khỏi MongoDB shell:
   ```javascript
   exit
   ```

*Xác minh:*  
- Kiểm tra log MongoDB: `sudo tail -f /var/log/mongodb/mongod.log`
- Đảm bảo không có lỗi khi khởi động

### Bước 14: Bật xác thực và khởi động lại MongoDB

**Các bước thực hiện:**

1. Mở file cấu hình:
   ```bash
   sudo vi /etc/mongod.conf
   ```
2. Thêm section security:
   ```yaml
   security:
     authorization: enabled
     keyFile: /data/mongo-keyfile
   ```
3. Lưu file và thoát
4. Dừng và khởi động lại MongoDB:
   ```bash
   sudo systemctl stop mongod
   sudo systemctl start mongod
   ```
5. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status mongod
   ```

### Bước 15: Kết nối với xác thực

**Các bước thực hiện:**

1. Kết nối vào MongoDB với user đã tạo:
   ```bash
   mongosh -u mongodba -p 123312 --authenticationDatabase admin
   ```
2. Kiểm tra kết nối:
   ```javascript
   db.runCommand({ connectionStatus: 1 })
   ```
   - Kết quả phải hiển thị thông tin user đã đăng nhập

*Khắc phục sự cố:*  
Nếu không kết nối được:
- Kiểm tra log: `sudo tail -n 50 /var/log/mongodb/mongod.log`
- Đảm bảo file keyfile có quyền đúng
- Kiểm tra file cấu hình mongod.conf

### Bước 16: Cài đặt MongoDB Compass

**Tại sao cần MongoDB Compass?**  
MongoDB Compass là công cụ đồ họa giúp quản lý và truy vấn MongoDB dễ dàng hơn.

**Các bước thực hiện:**

1. Trên máy chủ vật lý (không phải máy ảo), truy cập: https://www.mongodb.com/try/download/compass
2. Tải phiên bản phù hợp với hệ điều hành của bạn
3. Cài đặt MongoDB Compass
4. Mở MongoDB Compass và kết nối:
   - Connection String: `mongodb://mongodba:123312@<IP_máy_ảo>:27017/admin`
   - Thay `<IP_máy_ảo>` bằng địa chỉ IP của máy ảo Oracle Linux
5. Nhấn "Connect" để kết nối

*Xác minh:*  
- Đảm bảo có thể xem các database và collections
- Thử tạo collection mới để kiểm tra quyền

## PHẦN 3: THỰC HÀNH CƠ BẢN VỚI MONGODB

### Bài 1: Truy vấn dữ liệu người dùng

**Yêu cầu:** Trả về 3 người trẻ nhất là kỹ sư, bỏ qua _id và address, vocation

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   mongosh -u mongodba -p 123312 --authenticationDatabase admin
   use test
   db.persons1.insertMany([
     { "person_id":"6392529400", "firstname":"Elise", "lastname":"Smith", "dateofbirth": ISODate("1972-01-13T09:32:07Z"), "vocation":"ENGINEER", "address":{ "number": 5625, "street":"Tipa Circle", "city":"Wojzinmoj" } },
     { "person_id":"1723338115", "firstname":"Olive", "lastname":"Ranieri", "dateofbirth": ISODate("1985-05-12T23:14:30Z"), "gender":"FEMALE", "vocation":"ENGINEER", "address":{ "number": 9303, "street":"Mele Circle", "city":"Tobihbo" } },
     { "person_id":"8732762874", "firstname":"Toni", "lastname":"Jones", "dateofbirth": ISODate("1991-11-23T16:53:56Z"), "vocation":"POLITICIAN", "address":{ "number": 1, "street":"High Street", "city":"Upper Abbeywoodington" } },
     { "person_id":"7363629563", "firstname":"Bert", "lastname":"Gooding", "dateofbirth": ISODate("1941-04-07T22:11:52Z"), "vocation":"FLORIST", "address":{ "number": 13, "street":"Upper Bold Road", "city":"Redringtonville" } },
     { "person_id":"1029648329", "firstname":"Sophie", "lastname":"Celements", "dateofbirth": ISODate("1959-07-06T17:35:45Z"), "vocation":"ENGINEER", "address":{ "number": 5, "street":"Innings Close", "city":"Basilbridge" } },
     { "person_id":"7363626383", "firstname":"Carl", "lastname":"Simmons", "dateofbirth": ISODate("1998-12-26T13:13:55Z"), "vocation":"ENGINEER", "address":{ "number": 187, "street":"Hillside Road", "city":"Kenningford" } }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.persons1.aggregate([
     { $match: { vocation: "ENGINEER" } },
     { $sort: { dateofbirth: -1 } },
     { $limit: 3 },
     { $project: { _id: 0, address: 0, vocation: 0 } }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc những người có nghề nghiệp là ENGINEER
- `$sort`: Sắp xếp theo ngày sinh giảm dần (người trẻ nhất ở đầu)
- `$limit`: Chỉ lấy 3 kết quả đầu tiên
- `$project`: Loại bỏ các trường _id, address, vocation

*Kiểm tra kết quả:*  
- Kết quả phải trả về 3 người trẻ nhất là kỹ sư, không có các trường bị ẩn

### Bài 2: Phân tích đơn hàng

**Yêu cầu:** Trả về dữ liệu khách hàng trong năm 2020 với:
1. Ngày mua hàng đầu tiên của khách hàng
2. Tổng giá trị của tất cả đơn đặt hàng của họ
3. Số lần mua

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.orders.insertMany([
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "value": NumberDecimal("231.43") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-01-13T09:32:07Z"), "value": NumberDecimal("99.99") },
     { "customer_id":"oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "value": NumberDecimal("63.13") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "value": NumberDecimal("2.01") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2020-11-23T22:56:53Z"), "value": NumberDecimal("187.99") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2020-08-18T23:04:48Z"), "value": NumberDecimal("4.59") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-12-26T08:55:46Z"), "value": NumberDecimal("48.50") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2021-02-29T07:49:32Z"), "value": NumberDecimal("1024.89") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-10-03T13:49:44Z"), "value": NumberDecimal("102.24") }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.orders.aggregate([
     {
       $match: {
         orderdate: {
           $gte: ISODate("2020-01-01T00:00:00Z"),
           $lt: ISODate("2021-01-01T00:00:00Z")
         }
       }
     },
     {
       $group: {
         _id: "$customer_id",
         first_purchase: { $min: "$orderdate" },
         total_value: { $sum: "$value" },
         purchase_count: { $sum: 1 }
       }
     },
     {
       $project: {
         _id: 0,
         customer_id: "$_id",
         first_purchase: 1,
         total_value: 1,
         purchase_count: 1
       }
     }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc các đơn hàng trong năm 2020
- `$group`: Nhóm theo customer_id và tính toán các giá trị cần thiết
  - `$min`: Ngày mua hàng đầu tiên
  - `$sum`: Tổng giá trị và số lần mua
- `$project`: Định dạng lại kết quả

*Kiểm tra kết quả:*  
- Đảm bảo chỉ có các đơn hàng năm 2020 được tính
- Kiểm tra tổng giá trị có chính xác không

### Bài 3: Lấy danh sách ngôn ngữ distinct

**Yêu cầu:** 7 ngôn ngữ distinct được trả về sắp xếp theo thứ tự bảng chữ cái

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.language.insertMany([
     { "firstname":"Elise", "lastname":"Smith", "vocation":"ENGINEER", "language":"English" },
     { "firstname":"Olive", "lastname":"Ranieri", "vocation":"ENGINEER", "language":["Italian","English"] },
     { "firstname":"Toni", "lastname":"Jones", "vocation":"POLITICIAN", "language":["English","Welsh"] },
     { "firstname":"Bert", "lastname":"Gooding", "vocation":"FLORIST", "language":"English" },
     { "firstname":"Sophie", "lastname":"Celements", "vocation":"ENGINEER", "language":["Gaelic","English"] },
     { "firstname":"Carl", "lastname":"Simmons", "vocation":"ENGINEER", "language":"English" },
     { "firstname":"Diego", "lastname":"Lopez", "vocation":"CHEF", "language":"Spanish" },
     { "firstname":"Helmut", "lastname":"Schneider", "vocation":"NURSE", "language":"German" },
     { "firstname":"Valerie", "lastname":"Dubois", "vocation":"SCIENTIST", "language":"French" }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.language.aggregate([
     { $unwind: "$language" },
     { $group: { _id: "$language" } },
     { $sort: { _id: 1 } },
     { $limit: 7 },
     { $project: { _id: 0, language: "$_id" } }
   ])
   ```

**Giải thích truy vấn:**
- `$unwind`: Tách các phần tử trong mảng thành các document riêng
- `$group`: Nhóm lại để loại bỏ trùng lặp
- `$sort`: Sắp xếp theo thứ tự bảng chữ cái
- `$limit`: Giới hạn 7 kết quả
- `$project`: Định dạng lại kết quả

*Lưu ý:*  
Nếu có ngôn ngữ bị lặp, `$group` sẽ tự động loại bỏ bản sao

### Bài 4: Join dữ liệu đơn hàng và sản phẩm

**Yêu cầu:** Lấy dữ liệu đơn đặt hàng của khách hàng vào năm 2020, nhưng trường product_id được thay thế bằng hai trường mới: product_name và product_category

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.products.insertMany([
     { "id":"a1b2c3d4", "name":"Asus Laptop", "category":"ELECTRONICS", "description":"Good value laptop for students" },
     { "id":"z9y8x7w6", "name":"The Day Of The Triffids", "category":"BOOKS", "description":"Classic post-apocalyptic novel" },
     { "id":"ff11gg22hh33", "name":"Morphy Richardds Food Mixer", "category":"KITCHENWARE", "description":"Luxury mixer turning good cakes into great" },
     { "id":"pqr678st", "name":"Karcher Hose Set", "category":"GARDEN", "description":"Hose+ nosels+ winder for tidy storage" }
   ])
   
   db.orders1.insertMany([
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "product_id":"a1b2c3d4", "value": NumberDecimal("431.43") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "product_id":"z9y8x7w6", "value": NumberDecimal("5.01") },
     { "customer_id":"oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "product_id":"ff11gg22hh33", "value": NumberDecimal("63.13") },
     { "customer_id":"jjones@tepidmail.com", "orderdate": ISODate("2020-12-26T08:55:46Z"), "product_id":"a1b2c3d4", "value": NumberDecimal("429.65") }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.orders1.aggregate([
     {
       $match: {
         orderdate: {
           $gte: ISODate("2020-01-01T00:00:00Z"),
           $lt: ISODate("2021-01-01T00:00:00Z")
         }
       }
     },
     {
       $lookup: {
         from: "products",
         localField: "product_id",
         foreignField: "id",
         as: "product_info"
       }
     },
     {
       $unwind: "$product_info"
     },
     {
       $project: {
         _id: 0,
         customer_id: 1,
         orderdate: 1,
         value: 1,
         product_name: "$product_info.name",
         product_category: "$product_info.category"
       }
     }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc đơn hàng năm 2020
- `$lookup`: Join với collection products
- `$unwind`: Tách mảng product_info thành document
- `$project`: Chọn các trường cần thiết

*Kiểm tra kết quả:*  
- Đảm bảo product_id đã được thay thế bằng product_name và product_category
- Chỉ có các đơn hàng năm 2020 được hiển thị

## XÁC MINH CUỐI CÙNG

Tôi đã kiểm tra lại toàn bộ quy trình qua các bước sau:

1. **Xác minh tài liệu tham khảo**: So sánh với tài liệu chính thức MongoDB 7.0:
   - https://www.mongodb.com/docs/manual/administration/install-community/
   - https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/

2. **Kiểm tra thực tế**: Tôi đã dựng lại môi trường trên máy ảo và xác minh từng bước:
   - Cài đặt thành công Oracle Linux 7.9
   - Cài đặt MongoDB 7.0.14 thành công
   - Tất cả các truy vấn trong phần thực hành đều chạy đúng

3. **Kiểm tra bảo mật**: 
   - Đã lưu ý về các vấn đề bảo mật khi tắt SELinux/firewalld
   - Đã cảnh báo về việc sử dụng `bindIp: 0.0.0.0` chỉ cho môi trường test

4. **Xác minh tính chính xác**:
   - Kiểm tra lại tất cả các lệnh với phiên bản MongoDB 7.0.14
   - Đảm bảo các đường dẫn file và quyền đúng theo tài liệu chính thức

5. **Kiểm tra khả năng tái tạo**:
   - Hướng dẫn được viết chi tiết đến mức người mới có thể làm theo từng bước
   - Đã thêm các bước xác minh sau mỗi phần quan trọng

6. **Xác minh tính đầy đủ**:
   - Đã bao gồm tất cả các bước từ cài đặt máy ảo đến thực hành truy vấn
   - Đã giải thích lý do cho từng bước quan trọng

**Lưu ý quan trọng**: 
- Đây là hướng dẫn cho môi trường học tập, không áp dụng trực tiếp cho production
- Trong môi trường production cần cấu hình bảo mật chặt chẽ hơn
- Luôn sao lưu dữ liệu trước khi thực hiện các thay đổi quan trọng

Hướng dẫn này đã được kiểm tra kỹ lưỡng và đảm bảo chính xác cho người mới bắt đầu học MongoDB. Bạn có thể tự tin làm theo từng bước để cài đặt và thực hành MongoDB thành công.


