Chắc chắn rồi! Dưới đây là bản hướng dẫn chi tiết, được biên soạn lại từ tài liệu của bạn, theo phong cách "cầm tay chỉ việc" để người mới bắt đầu có thể dễ dàng theo dõi và thực hành.

Mỗi bước sẽ được giải thích rõ ràng về **Mục đích** (Tại sao chúng ta làm vậy?) và **Cách thực hiện** (Làm như thế nào?), kèm theo các lệnh chính xác và giải thích cụ thể.

***

### **Hướng Dẫn Thực Hành MongoDB - Day 1 (Phiên bản chi tiết cho người mới bắt đầu)**

Chào mừng bạn đến với buổi thực hành đầu tiên về MongoDB! Hướng dẫn này sẽ giúp bạn cài đặt MongoDB từ A-Z trên một máy ảo Linux, cấu hình bảo mật và thực hiện các truy vấn cơ bản.

---

### **Phần 1: Chuẩn bị Môi trường (Cài đặt Máy ảo)**

**Mục đích:** Chúng ta sẽ tạo một máy ảo (Virtual Machine - VM) để cài đặt MongoDB. Việc này giúp tạo ra một môi trường thực hành tách biệt, an toàn, không ảnh hưởng đến máy tính chính của bạn.

#### **Bước 1.1: Cài đặt phần mềm giả lập máy ảo**

*   **Phần mềm:** Chúng ta sẽ dùng **VMware Workstation Player**, đây là phiên bản miễn phí cho mục đích cá nhân và học tập.
*   **Thực hiện:**
    1.  Truy cập trang chủ của VMware để tải về: [Tải VMware Workstation Player](https://www.vmware.com/go/downloadplayer)
    2.  Chọn phiên bản phù hợp với hệ điều hành của bạn (Windows hoặc Linux) và tiến hành cài đặt như một phần mềm thông thường.

#### **Bước 1.2: Tải file cài đặt hệ điều hành Oracle Linux**

*   **Mục đích:** Chúng ta cần file `.iso` của hệ điều hành để cài đặt lên máy ảo. Hướng dẫn này sử dụng Oracle Linux 7.9, một bản phân phối tương thích cao với MongoDB.
*   **Thực hiện:**
    1.  Truy cập trang Oracle Software Delivery Cloud: [https://edelivery.oracle.com/](https://edelivery.oracle.com/) (Bạn có thể cần tạo một tài khoản Oracle miễn phí).
    2.  Tìm kiếm "Oracle Linux" và chọn phiên bản **7.9**.
    3.  Tải về file ISO có tên tương tự như `V984216-01.iso` (Oracle Linux Release 7 Update 9 for x86_64).

#### **Bước 1.3: Tạo và Cài đặt máy ảo Oracle Linux 7.9**

*   **Thực hiện:**
    1.  Mở VMware Workstation Player.
    2.  Chọn **"Create a New Virtual Machine"**.
    3.  Chọn **"Installer disc image file (iso)"** và trỏ đến file Oracle Linux 7.9 bạn vừa tải về.
    4.  Điền các thông tin cơ bản cho máy ảo (tên người dùng, mật khẩu).
    5.  Đặt tên cho máy ảo (ví dụ: `MongoDB-Practice-VM`).
    6.  **Cấu hình phần cứng (Customize Hardware):**
        *   **Memory (RAM):** Tối thiểu **2 GB** (Khuyến nghị 4 GB).
        *   **Processors (CPU):** Tối thiểu **2 cores**.
        *   **Network Adapter:** Chọn **NAT**. Chế độ này giúp máy ảo kết nối Internet thông qua máy tính thật của bạn một cách dễ dàng.
    7.  Hoàn tất và khởi động máy ảo. Quá trình cài đặt Oracle Linux sẽ tự động diễn ra. Sau khi hoàn tất, bạn có thể đăng nhập bằng tài khoản đã tạo ở trên.

#### **Bước 1.4: Đặt IP và kiểm tra kết nối Internet**

*   **Mục đích:** Đảm bảo máy ảo có thể kết nối Internet để tải MongoDB về.
*   **Thực hiện:**
    1.  Mở cửa sổ dòng lệnh (Terminal) trên máy ảo Linux.
    2.  Kiểm tra kết nối bằng lệnh `ping`:
        ```bash
        ping google.com
        ```
        Nếu nhận được phản hồi, máy ảo của bạn đã kết nối Internet. Nhấn `Ctrl + C` để dừng.
    3.  Kiểm tra địa chỉ IP của máy ảo bằng lệnh `ip a`. Bạn sẽ cần IP này ở các bước sau để kết nối từ máy thật.

---

### **Phần 2: Cài đặt MongoDB trên Linux**

Bây giờ, chúng ta sẽ thực hiện các bước cấu hình và cài đặt MongoDB trên máy ảo vừa tạo.

#### **2.1. Cấu hình các tham số hệ thống (Kernel Parameters)**

**Mục đích:** MongoDB yêu cầu một số cấu hình hệ thống đặc thù để hoạt động ổn định và hiệu suất cao.

##### **a. Vô hiệu hóa SELinux**

*   **Giải thích:** SELinux (Security-Enhanced Linux) là một module bảo mật có thể gây xung đột với MongoDB. Chúng ta cần vô hiệu hóa nó.
*   **Thực hiện:**
    1.  Chạy lệnh sau để vô hiệu hóa tạm thời (có hiệu lực ngay lập tức):
        ```bash
        sudo setenforce 0
        ```
    2.  Mở file cấu hình để vô hiệu hóa vĩnh viễn (có hiệu lực sau khi khởi động lại):
        ```bash
        sudo vi /etc/selinux/config
        ```
    3.  Trong `vi`, nhấn phím `i` để vào chế độ chỉnh sửa. Tìm dòng `SELINUX=enforcing` và sửa thành:
        ```
        SELINUX=disabled
        ```
    4.  Nhấn `Esc`, gõ `:wq` và nhấn `Enter` để lưu và thoát.

##### **b. Dừng và vô hiệu hóa Firewall**

*   **Giải thích:** Để thực hành, chúng ta sẽ tạm thời tắt tường lửa để dễ dàng kết nối. Trong môi trường thực tế, bạn nên mở cổng 27017 thay vì tắt hoàn toàn.
*   **Thực hiện:**
    ```bash
    sudo systemctl stop firewalld
    sudo systemctl disable firewalld
    ```

##### **c. Cấu hình giới hạn `ulimit` cho MongoDB**

*   **Giải thích:** MongoDB cần quyền mở nhiều file và tiến trình đồng thời. Chúng ta cần tăng giới hạn này lên.
*   **Thực hiện:**
    1.  Tạo một file cấu hình mới:
        ```bash
        sudo vi /etc/security/limits.d/99-mongodb-nproc.conf
        ```
    2.  Nhấn `i` và dán nội dung sau vào file:
        ```
        mongod   soft   nofile   64000
        mongod   hard   nofile   64000
        mongod   soft   nproc    64000
        mongod   hard   nproc    64000
        ```
    3.  Nhấn `Esc`, gõ `:wq` và `Enter`.

##### **d. Vô hiệu hóa Transparent Huge Pages (THP)**

*   **Giải thích:** THP là một tính năng quản lý bộ nhớ của Linux có thể làm giảm hiệu suất của MongoDB.
*   **Thực hiện:**
    1.  Tạo một file dịch vụ (service) để tự động tắt THP mỗi khi khởi động:
        ```bash
        sudo vi /etc/systemd/system/disable-transparent-huge-pages.service
        ```
    2.  Dán nội dung sau vào file:
        ```
        [Unit]
        Description=Disable Transparent Huge Pages (THP)
        DefaultDependencies=no
        After=sysinit.target local-fs.target
        Before=mongod.service

        [Service]
        Type=oneshot
        ExecStart=/bin/sh -c 'echo never | tee /sys/kernel/mm/transparent_hugepage/enabled > /dev/null'

        [Install]
        WantedBy=basic.target
        ```
    3.  Lưu và thoát (`Esc`, `:wq`, `Enter`).
    4.  Kích hoạt dịch vụ này:
        ```bash
        sudo systemctl daemon-reload
        sudo systemctl start disable-transparent-huge-pages
        sudo systemctl enable disable-transparent-huge-pages
        ```

#### **2.2. Cài đặt MongoDB**

##### **a. Cấu hình Repository của MongoDB**

*   **Giải thích:** Chúng ta cần cho hệ thống biết nơi để tải các gói cài đặt MongoDB.
*   **Thực hiện:**
    1.  Tạo file repository:
        ```bash
        sudo vi /etc/yum.repos.d/mongodb-enterprise-7.0.repo
        ```
    2.  Dán nội dung sau vào file:
        ```
        [mongodb-enterprise-7.0]
        name=MongoDB Enterprise Repository
        baseurl=https://repo.mongodb.com/yum/redhat/7/mongodb-enterprise/7.0/$basearch/
        gpgcheck=1
        enabled=1
        gpgkey=https://pgp.mongodb.com/server-7.0.asc
        ```
    3.  Lưu và thoát.

##### **b. Cài đặt các gói MongoDB Enterprise**

*   **Giải thích:** Lệnh sau sẽ cài đặt server MongoDB, shell kết nối (`mongosh`), và các công cụ cần thiết khác.
*   **Thực hiện:**
    ```bash
    sudo yum install -y mongodb-enterprise
    ```
    *(Lưu ý: Lệnh này sẽ tự động cài các gói phụ thuộc như `mongodb-enterprise-server`, `mongodb-mongosh`, v.v.)*

#### **2.3. Cấu hình MongoDB**

##### **a. Tạo thư mục chứa dữ liệu**

*   **Giải thích:** Chúng ta sẽ tạo một thư mục riêng để lưu trữ cơ sở dữ liệu.
*   **Thực hiện:**
    ```bash
    sudo mkdir -p /data/datafile
    sudo chown -R mongod:mongod /data
    ```

##### **b. Chỉnh sửa file cấu hình `mongod.conf`**

*   **Giải thích:** Đây là file cấu hình chính của MongoDB, nơi chúng ta chỉ định đường dẫn dữ liệu và cấu hình mạng.
*   **Thực hiện:**
    1.  Mở file cấu hình:
        ```bash
        sudo vi /etc/mongod.conf
        ```
    2.  Chỉnh sửa các mục sau:
        *   Tìm đến mục `storage:` và thay đổi `dbPath` thành:
            ```yaml
            storage:
              dbPath: /data/datafile
            ```
        *   Tìm đến mục `net:` và thay đổi `bindIp` để cho phép kết nối từ bên ngoài máy ảo (ví dụ: từ máy thật của bạn).
            ```yaml
            net:
              port: 27017
              bindIp: 0.0.0.0
            ```
    3.  Lưu và thoát.

#### **2.4. Kích hoạt Xác thực (Authentication)**

**Mục đích:** Đây là bước cực kỳ quan trọng để bảo mật CSDL. Chúng ta sẽ tạo một người dùng admin và yêu cầu đăng nhập mỗi khi kết nối.

##### **a. Khởi động MongoDB lần đầu (chưa có bảo mật)**
```bash
sudo systemctl start mongod
```

##### **b. Tạo người dùng Quản trị (Admin)**

1.  Kết nối vào MongoDB shell:
    ```bash
    mongosh
    ```
2.  Chuyển sang CSDL `admin`:
    ```javascript
    use admin
    ```
3.  Tạo người dùng `mongodba` với mật khẩu `123312` và quyền `root`.
    ```javascript
    db.createUser({
      user: "mongodba",
      pwd: "123312",
      roles: [{ role: "root", db: "admin" }]
    })
    ```
4.  Gõ `exit` để thoát khỏi `mongosh`.

##### **c. Tạo Keyfile và bật xác thực**

1.  Tạo một keyfile để xác thực giữa các thành viên trong replica set (hữu ích cho sau này).
    ```bash
    sudo openssl rand -base64 756 > /data/mongo-keyfile
    sudo chmod 400 /data/mongo-keyfile
    sudo chown mongod:mongod /data/mongo-keyfile
    ```
2.  Mở lại file cấu hình `mongod.conf`:
    ```bash
    sudo vi /etc/mongod.conf
    ```
3.  Thêm mục `security` vào cuối file:
    ```yaml
    security:
      authorization: enabled
      keyFile: /data/mongo-keyfile
    ```
4.  Lưu và thoát.

##### **d. Khởi động lại MongoDB với chế độ bảo mật**

```bash
sudo systemctl stop mongod
sudo systemctl start mongod
```

##### **e. Kiểm tra kết nối có xác thực**

*   **Thực hiện:** Bây giờ, nếu bạn kết nối mà không có tên người dùng và mật khẩu, bạn sẽ không có quyền. Hãy thử kết nối đúng cách:
    ```bash
    mongosh -u mongodba -p --authenticationDatabase admin
    ```
*   Hệ thống sẽ yêu cầu bạn nhập mật khẩu. Hãy nhập `123312`.
*   Nếu bạn thấy dấu nhắc `Enterprise test>` và có thể chạy lệnh `show dbs` thành công, **chúc mừng bạn đã cài đặt và bảo mật MongoDB thành công!**

---

### **Phần 3: Kết nối bằng MongoDB Compass**

**Mục đích:** MongoDB Compass là một công cụ giao diện đồ họa (GUI) giúp bạn tương tác với CSDL một cách trực quan hơn.

#### **Bước 3.1: Tải và cài đặt MongoDB Compass**
*   Truy cập và tải về tại: [Tải MongoDB Compass](https://www.mongodb.com/try/download/compass)
*   Cài đặt trên **máy tính thật** của bạn.

#### **Bước 3.2: Kết nối tới CSDL trên máy ảo**
1.  Mở MongoDB Compass.
2.  Trong màn hình kết nối, chọn **"Fill in connection fields individually"**.
3.  Điền các thông tin sau:
    *   **Hostname:** Điền địa chỉ IP của máy ảo Linux mà bạn đã lấy ở Bước 1.4 (ví dụ: `10.168.4.64`).
    *   **Port:** `27017` (mặc định).
    *   **Authentication:** Chọn `Username / Password`.
    *   **Username:** `mongodba`
    *   **Password:** `123312`
    *   **Authentication Database:** `admin`
4.  Nhấn nút **Connect**. Compass sẽ kết nối đến CSDL trên máy ảo của bạn.



---

### **Phần 4: Thực hành các thao tác Aggregation**

Bây giờ là lúc sử dụng những gì đã học. Chúng ta sẽ chèn dữ liệu và thực hiện các truy vấn phức tạp bằng Aggregation Framework.

Bạn có thể chạy các lệnh này trong `mongosh` hoặc trong tab `Shell` của MongoDB Compass.

#### **Bài 1: Lọc và sắp xếp dữ liệu nhân sự**

*   **Dữ liệu:**
    ```javascript
    // Chuyển sang một database mới để thực hành
    use practiceDB

    // Chèn dữ liệu vào collection 'persons'
    db.persons.insertMany([
        { "person_id": "6392529400", "firstname": "Elise", "lastname": "Smith", "dateofbirth": ISODate("1972-01-13T09:32:07Z"), "vocation": "ENGINEER", "address": { "number": 5625, "street": "Tipa Circle", "city": "Wojzinmoj" } },
        { "person_id": "1723338115", "firstname": "Olive", "lastname": "Ranieri", "dateofbirth": ISODate("1985-05-12T23:14:30Z"), "gender": "FEMALE", "vocation": "ENGINEER", "address": { "number": 9303, "street": "Mele Circle", "city": "Tobihbo" } },
        { "person_id": "8732762874", "firstname": "Toni", "lastname": "Jones", "dateofbirth": ISODate("1991-11-23T16:53:56Z"), "vocation": "POLITICIAN", "address": { "number": 1, "street": "High Street", "city": "Upper Abbeywoodington" } },
        { "person_id": "7363629563", "firstname": "Bert", "lastname": "Gooding", "dateofbirth": ISODate("1941-04-07T22:11:52Z"), "vocation": "FLORIST", "address": { "number": 13, "street": "Upper Bold Road", "city": "Redringtonville" } },
        { "person_id": "1029648329", "firstname": "Sophie", "lastname": "Celements", "dateofbirth": ISODate("1959-07-06T17:35:45Z"), "vocation": "ENGINEER", "address": { "number": 5, "street": "Innings Close", "city": "Basilbridge" } },
        { "person_id": "7363626383", "firstname": "Carl", "lastname": "Simmons", "dateofbirth": ISODate("1998-12-26T13:13:55Z"), "vocation": "ENGINEER", "address": { "number": 187, "street": "Hillside Road", "city": "Kenningford" } }
    ]);
    ```

*   **Yêu cầu:** Trả về 3 người là kỹ sư (ENGINEER) **trẻ nhất**. Chỉ hiển thị `firstname`, `lastname`, `dateofbirth`.
*   **Logic giải quyết:**
    1.  `$match`: Lọc ra những người có `vocation` là "ENGINEER".
    2.  `$sort`: Sắp xếp theo `dateofbirth` giảm dần (ngày sinh càng lớn thì càng trẻ).
    3.  `$limit`: Giới hạn kết quả chỉ lấy 3 người đầu tiên.
    4.  `$project`: Định dạng lại đầu ra, chỉ hiển thị các trường mong muốn và ẩn `_id`.
*   **Truy vấn:**
    ```javascript
    db.persons.aggregate([
      // Stage 1: Filter for engineers
      {
        $match: { vocation: "ENGINEER" }
      },
      // Stage 2: Sort by birth date descending (youngest first)
      {
        $sort: { dateofbirth: -1 }
      },
      // Stage 3: Limit to the top 3
      {
        $limit: 3
      },
      // Stage 4: Project the desired fields
      {
        $project: {
          _id: 0,
          firstname: 1,
          lastname: 1,
          dateofbirth: 1
        }
      }
    ])
    ```
*   **Kết quả mong đợi:**
    ```json
    [
      { "firstname": "Carl", "lastname": "Simmons", "dateofbirth": ISODate("1998-12-26T13:13:55.000Z") },
      { "firstname": "Olive", "lastname": "Ranieri", "dateofbirth": ISODate("1985-05-12T23:14:30.000Z") },
      { "firstname": "Elise", "lastname": "Smith", "dateofbirth": ISODate("1972-01-13T09:32:07.000Z") }
    ]
    ```

---
*Các bài tập tiếp theo sẽ được phân tích tương tự, bạn có thể tự mình thử giải quyết trước khi xem đáp án.*

#### **Bài 2: Thống kê đơn hàng của khách hàng**

*   **Dữ liệu:**
    ```javascript
    db.orders.insertMany([
        { "customer_id": "elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "value": NumberDecimal("231.43") },
        { "customer_id": "elise_smith@myemail.com", "orderdate": ISODate("2020-01-13T09:32:07Z"), "value": NumberDecimal("99.99") },
        { "customer_id": "oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "value": NumberDecimal("63.13") },
        { "customer_id": "tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "value": NumberDecimal("2.01") },
        { "customer_id": "tj@wheresmyemail.com", "orderdate": ISODate("2020-11-23T22:56:53Z"), "value": NumberDecimal("187.99") },
        { "customer_id": "elise_smith@myemail.com", "orderdate": ISODate("2020-12-26T08:55:46Z"), "value": NumberDecimal("48.50") },
    ]);
    ```

*   **Yêu cầu:** Trả về dữ liệu thống kê của các khách hàng có đơn hàng **trong năm 2020**, thể hiện:
    1.  Ngày mua hàng đầu tiên của khách hàng.
    2.  Tổng giá trị của tất cả đơn hàng.
    3.  Tổng số lần mua hàng.
*   **Logic giải quyết:**
    1.  `$match`: Lọc các đơn hàng có `orderdate` trong năm 2020.
    2.  `$group`: Nhóm các đơn hàng theo `customer_id`. Trong giai đoạn này, sử dụng các toán tử tích lũy:
        *   `$min` để tìm ngày mua hàng đầu tiên.
        *   `$sum` để tính tổng giá trị.
        *   `$sum: 1` để đếm số lượng đơn hàng.
*   **Truy vấn:**
    ```javascript
    db.orders.aggregate([
      // Stage 1: Filter for orders in 2020
      {
        $match: {
          orderdate: {
            $gte: ISODate("2020-01-01T00:00:00Z"),
            $lt: ISODate("2021-01-01T00:00:00Z")
          }
        }
      },
      // Stage 2: Group by customer and calculate aggregates
      {
        $group: {
          _id: "$customer_id",
          first_purchase_date: { $min: "$orderdate" },
          total_value: { $sum: "$value" },
          purchase_count: { $sum: 1 }
        }
      }
    ])
    ```
*   **Kết quả mong đợi:**
    ```json
    [
      { "_id": "tj@wheresmyemail.com", "first_purchase_date": ISODate("2020-11-23T22:56:53.000Z"), "total_value": NumberDecimal("187.99"), "purchase_count": 1 },
      { "_id": "oranieri@warmmail.com", "first_purchase_date": ISODate("2020-01-01T08:25:37.000Z"), "total_value": NumberDecimal("63.13"), "purchase_count": 1 },
      { "_id": "elise_smith@myemail.com", "first_purchase_date": ISODate("2020-01-13T09:32:07.000Z"), "total_value": NumberDecimal("379.92"), "purchase_count": 3 }
    ]
    ```

#### **Bài 3: Join dữ liệu giữa hai collection (`$lookup`)**

*   **Dữ liệu:**
    ```javascript
    // Collection 'products'
    db.products.insertMany([
        { "id": "a1b2c3d4", "name": "Asus Laptop", "category": "ELECTRONICS" },
        { "id": "z9y8x7w6", "name": "The Day Of The Triffids", "category": "BOOKS" },
        { "id": "ff11gg22hh33", "name": "Morphy Richards Food Mixer", "category": "KITCHENWARE" }
    ]);

    // Collection 'orders1' (lưu ý tên khác với bài 2)
    db.orders1.insertMany([
        { "customer_id": "elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "product_id": "a1b2c3d4", "value": NumberDecimal("431.43") },
        { "customer_id": "tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "product_id": "z9y8x7w6", "value": NumberDecimal("5.01") },
        { "customer_id": "oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "product_id": "ff11gg22hh33", "value": NumberDecimal("63.13") }
    ]);
    ```

*   **Yêu cầu:** Lấy dữ liệu các đơn hàng trong năm 2020, nhưng thay vì hiển thị `product_id`, hãy hiển thị thông tin chi tiết của sản phẩm (`product_name` và `product_category`) từ collection `products`.
*   **Logic giải quyết:**
    1.  `$match`: Lọc các đơn hàng trong năm 2020 từ collection `orders1`.
    2.  `$lookup`: Đây là toán tử "join" của MongoDB.
        *   `from`: collection `products` để join vào.
        *   `localField`: trường khóa ở collection hiện tại (`orders1`), là `product_id`.
        *   `foreignField`: trường khóa ở collection `from`, là `id`.
        *   `as`: tên của mảng mới chứa kết quả join, ví dụ `product_details`.
    3.  `$unwind`: Tách mảng `product_details` ra thành các document riêng lẻ.
    4.  `$project`: Tùy chỉnh lại kết quả cuối cùng.
*   **Truy vấn:**
    ```javascript
    db.orders1.aggregate([
      // Stage 1: Filter for orders in 2020
      {
        $match: {
          orderdate: {
            $gte: ISODate("2020-01-01T00:00:00Z"),
            $lt: ISODate("2021-01-01T00:00:00Z")
          }
        }
      },
      // Stage 2: Join with the products collection
      {
        $lookup: {
          from: "products",
          localField: "product_id",
          foreignField: "id",
          as: "product_details"
        }
      },
      // Stage 3: Deconstruct the product_details array
      {
        $unwind: "$product_details"
      },
      // Stage 4: Project the final output
      {
        $project: {
          _id: 0,
          customer_id: 1,
          orderdate: 1,
          value: 1,
          product_name: "$product_details.name",
          product_category: "$product_details.category"
        }
      }
    ])
    ```
*   **Kết quả mong đợi:**
    ```json
    [
      { "customer_id" : "elise_smith@myemail.com", "orderdate" : ISODate("2020-05-30T08:35:52.000Z"), "value" : NumberDecimal("431.43"), "product_name" : "Asus Laptop", "product_category" : "ELECTRONICS" },
      { "customer_id" : "oranieri@warmmail.com", "orderdate" : ISODate("2020-01-01T08:25:37.000Z"), "value" : NumberDecimal("63.13"), "product_name" : "Morphy Richards Food Mixer", "product_category" : "KITCHENWARE" }
    ]
    ```

***

Hy vọng với hướng dẫn chi tiết này, bạn đã có một khởi đầu vững chắc với MongoDB. Hãy tiếp tục thực hành và khám phá thêm các tính năng mạnh mẽ khác như indexing, replica sets và sharding

--------------------------------------------------- 

# HƯỚNG DẪN CHI TIẾT CÀI ĐẶT VÀ SỬ DỤNG MONGODB TỪ A ĐẾN Z

## PHẦN 1: CHUẨN BỊ MÔI TRƯỜNG

### Bước 1: Tải và cài đặt VMware Workstation

**Tại sao cần VMware?**  
MongoDB thường được cài trên máy chủ Linux, nhưng nếu bạn đang dùng Windows/Mac, VMware sẽ giúp tạo máy ảo Linux để cài đặt MongoDB.

**Các bước thực hiện:**

1. Truy cập trang chủ VMware: https://www.vmware.com/products/workstation-player/workstation-player-evaluation.html
2. Tải phiên bản VMware Workstation Player (miễn phí cho mục đích cá nhân)
   - *Lưu ý: Phiên bản Pro có trả phí nhưng Player đủ cho mục đích học tập*
3. Chạy file cài đặt và làm theo hướng dẫn trên màn hình
   - Chấp nhận điều khoản
   - Chọn vị trí cài đặt (giữ mặc định)
   - Bỏ chọn các thành phần không cần thiết như "Check for updates"
   - Nhấn "Install" và chờ quá trình hoàn tất
4. Khởi động lại máy tính nếu được yêu cầu

*Kiểm tra xác minh:*  
- Sau khi cài đặt xong, mở VMware Workstation Player để đảm bảo chương trình chạy bình thường
- Xác minh phiên bản: Help > About VMware Workstation Player

### Bước 2: Tải file ISO Oracle Linux 7.9

**Tại sao chọn Oracle Linux 7.9?**  
Oracle Linux là một bản phân phối Linux tương thích với RHEL (Red Hat Enterprise Linux), được MongoDB hỗ trợ chính thức.

**Các bước thực hiện:**

1. Truy cập trang tải Oracle Linux: https://www.oracle.com/linux/downloads/linux7-iso.html
2. Tải file ISO "Oracle Linux Release 7 Update 9 for x86_64 (64 bit)"
   - Chọn phiên bản "Oracle Linux 7.9 for x86_64 (64 bit)"
   - File cần tải: `OracleLinux-R7-U9-Server-x86_64-dvd.iso`
3. Lưu file ISO vào thư mục dễ tìm (ví dụ: `C:\ISO\OracleLinux`)

*Xác minh tính toàn vẹn của file ISO:*  
- Tải file checksum từ trang chủ: https://www.oracle.com/linux/checksums/
- So sánh checksum với file ISO đã tải bằng công cụ như `certutil` trên Windows:
  ```
  certutil -hashfile "C:\ISO\OracleLinux\OracleLinux-R7-U9-Server-x86_64-dvd.iso" SHA256
  ```
- So sánh kết quả với giá trị trên trang chủ để đảm bảo file không bị hỏng

### Bước 3: Tạo máy ảo Oracle Linux trên VMware

**Các bước thực hiện:**

1. Mở VMware Workstation Player
2. Chọn "Create a New Virtual Machine"
3. Trong cửa sổ "New Virtual Machine Wizard":
   - Chọn "Installer disc image file (iso):" và chỉ đến file ISO đã tải
   - Nhấn "Next"
4. Nhập thông tin đăng nhập:
   - Username: oracle
   - Password: oracle123 (lưu lại để dùng sau)
   - Nhấn "Next"
5. Đặt tên máy ảo:
   - Virtual machine name: MongoDB_Server
   - Location: Chọn thư mục lưu máy ảo (ít nhất 40GB trống)
   - Nhấn "Next"
6. Chỉ định dung lượng:
   - Disk capacity: 40GB (tối thiểu)
   - Chọn "Store virtual disk as a single file"
   - Nhấn "Next"
7. Customize Hardware:
   - Memory: 4GB (tối thiểu)
   - Processors: 2 cores
   - Network Adapter: Bridged (để máy ảo có IP riêng trên mạng)
   - Nhấn "Close" sau khi cấu hình xong
8. Nhấn "Finish" để tạo máy ảo

*Kiểm tra xác minh:*  
- Khởi động máy ảo và đảm bảo hệ điều hành Oracle Linux 7.9 khởi động bình thường
- Đăng nhập bằng tài khoản đã tạo ở bước 4

### Bước 4: Cấu hình mạng và cập nhật hệ thống

**Tại sao cần cấu hình mạng?**  
Để máy ảo kết nối internet, tải các gói phần mềm cần thiết cho MongoDB.

**Các bước thực hiện:**

1. Đăng nhập vào Oracle Linux với tài khoản đã tạo
2. Mở Terminal (nhấp chuột phải trên desktop > Open Terminal)
3. Xác định tên card mạng:
   ```bash
   ip addr
   ```
   - Thông thường là `ens32` hoặc `eth0`
4. Chỉnh sửa file cấu hình mạng:
   ```bash
   sudo vi /etc/sysconfig/network-scripts/ifcfg-ens32
   ```
   *(Thay ens32 bằng tên card mạng của bạn)*
5. Sửa các thông số sau:
   ```
   BOOTPROTO=static
   ONBOOT=yes
   IPADDR=192.168.1.100  # Chọn IP phù hợp với mạng của bạn
   NETMASK=255.255.255.0
   GATEWAY=192.168.1.1
   DNS1=8.8.8.8
   DNS2=8.8.4.4
   ```
6. Lưu file và thoát (trong vi: nhấn ESC > :wq > Enter)
7. Khởi động lại dịch vụ mạng:
   ```bash
   sudo systemctl restart network
   ```
8. Kiểm tra kết nối internet:
   ```bash
   ping google.com
   ```
   - Nếu có phản hồi, bạn đã kết nối internet thành công
9. Cập nhật hệ thống:
   ```bash
   sudo yum update -y
   ```

*Xác minh:*  
- Chạy lệnh `ip addr show ens32` để kiểm tra IP đã được gán đúng
- Chạy `ping 8.8.8.8` để kiểm tra kết nối mạng cơ bản

## PHẦN 2: CÀI ĐẶT VÀ CẤU HÌNH MONGODB

### Bước 5: Tắt SELinux

**Tại sao cần tắt SELinux?**  
SELinux (Security-Enhanced Linux) có thể gây xung đột với MongoDB do các chính sách bảo mật nghiêm ngặt. Tắt SELinux giúp MongoDB hoạt động ổn định hơn.

**Các bước thực hiện:**

1. Mở file cấu hình SELinux:
   ```bash
   sudo vi /etc/selinux/config
   ```
2. Tìm dòng `SELINUX=enforcing` và thay bằng:
   ```
   SELINUX=disabled
   ```
3. Lưu file và thoát
4. Khởi động lại máy ảo:
   ```bash
   sudo reboot
   ```
5. Sau khi khởi động lại, kiểm tra trạng thái SELinux:
   ```bash
   sestatus
   ```
   - Kết quả phải hiển thị `SELinux status: disabled`

*Thay thế an toàn:*  
Nếu không muốn tắt SELinux hoàn toàn, có thể cấu hình các chính sách riêng cho MongoDB, nhưng với người mới, tắt SELinux là cách đơn giản nhất.

### Bước 6: Tắt firewalld

**Tại sao cần tắt firewalld?**  
Firewalld có thể chặn cổng 27017 (cổng mặc định của MongoDB), gây khó khăn cho việc kết nối.

**Các bước thực hiện:**

1. Dừng firewalld:
   ```bash
   sudo systemctl stop firewalld
   ```
2. Vô hiệu hóa firewalld để không khởi động cùng hệ thống:
   ```bash
   sudo systemctl disable firewalld
   ```
3. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status firewalld
   ```
   - Kết quả phải hiển thị "Active: inactive (dead)"

*Lưu ý bảo mật:*  
Trong môi trường production, bạn nên cấu hình firewalld để chỉ mở cổng 27017 cho các IP được phép kết nối thay vì tắt hoàn toàn.

### Bước 7: Cấu hình tham số kernel cho MongoDB

**Tại sao cần cấu hình ulimit?**  
MongoDB yêu cầu giới hạn tài nguyên hệ thống cao hơn mặc định để hoạt động ổn định, đặc biệt là số lượng file mở tối đa và số tiến trình.

**Các bước thực hiện:**

1. Tạo file cấu hình ulimit:
   ```bash
   sudo vi /etc/security/limits.d/99-mongodb-nproc.conf
   ```
2. Thêm các dòng sau vào file:
   ```
   mongod soft nofile 64000
   mongod hard nofile 64000
   root soft nofile 64000
   root hard nofile 64000
   
   mongod hard memlock unlimited
   mongod soft memlock unlimited
   root hard memlock unlimited
   root soft memlock unlimited
   
   mongod soft data unlimited
   mongod hard data unlimited
   root soft data unlimited
   root hard data unlimited
   
   mongod soft nproc 64000
   mongod hard nproc 64000
   root soft nproc 64000
   root hard nproc 64000
   ```
3. Lưu file và thoát
4. Cấu hình sysctl:
   ```bash
   sudo vi /etc/sysctl.conf
   ```
5. Thêm các dòng sau vào cuối file:
   ```
   fs.file-max = 6815744
   kernel.pid_max = 64000
   kernel.threads-max = 64000
   vm.swappiness = 1
   net.ipv4.ip_local_port_range = 1024 65530
   vm.max_map_count = 9999999
   net.ipv4.tcp_keepalive_time = 120
   ```
6. Áp dụng các thay đổi:
   ```bash
   sudo sysctl -p
   ```

*Xác minh:*  
- Kiểm tra giới hạn file: `ulimit -n` (phải trả về 64000)
- Kiểm tra giới hạn tiến trình: `ulimit -u` (phải trả về 64000)

### Bước 8: Tắt Transparent Huge Pages (THP)

**Tại sao cần tắt THP?**  
Transparent Huge Pages có thể gây hiệu năng không ổn định cho MongoDB do cách quản lý bộ nhớ.

**Các bước thực hiện:**

1. Tạo file service để tắt THP:
   ```bash
   sudo vi /etc/systemd/system/disable-transparent-huge-pages.service
   ```
2. Thêm nội dung sau:
   ```
   [Unit]
   Description=Disable Transparent Huge Pages (THP)
   DefaultDependencies=no
   After=sysinit.target local-fs.target
   Before=mongod.service
   
   [Service]
   Type=oneshot
   ExecStart=/bin/sh -c 'echo never | tee /sys/kernel/mm/transparent_hugepage/enabled > /dev/null'
   
   [Install]
   WantedBy=basic.target
   ```
3. Lưu file và thoát
4. Kích hoạt service:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl start disable-transparent-huge-pages
   sudo systemctl enable disable-transparent-huge-pages
   ```
5. Kiểm tra trạng thái:
   ```bash
   cat /sys/kernel/mm/transparent_hugepage/enabled
   ```
   - Kết quả phải hiển thị `[never] madvise always`

*Xác minh:*  
- Chạy lệnh `cat /sys/kernel/mm/transparent_hugepage/enabled` sau khi khởi động lại để đảm bảo THP vẫn bị tắt

### Bước 9: Cài đặt MongoDB Community Edition 7.0.14

**Tại sao chọn phiên bản 7.0.14?**  
Đây là phiên bản mới nhất (theo tài liệu) với các tính năng và sửa lỗi mới nhất.

**Các bước thực hiện:**

1. Tạo file repo cho MongoDB:
   ```bash
   sudo vi /etc/yum.repos.d/mongodb-enterprise-7.0.repo
   ```
2. Thêm nội dung sau:
   ```
   [mongodb-enterprise-7.0]
   name=MongoDB Enterprise Repository
   baseurl=https://repo.mongodb.com/yum/redhat/7/mongodb-enterprise/7.0/$basearch/
   gpgcheck=1
   enabled=1
   gpgkey=https://pgp.mongodb.com/server-7.0.asc
   ```
3. Lưu file và thoát
4. Import GPG key:
   ```bash
   sudo rpm --import https://pgp.mongodb.com/server-7.0.asc
   ```
5. Cài đặt MongoDB:
   ```bash
   sudo yum install -y mongodb-enterprise-7.0.14 mongodb-enterprise-database-7.0.14 mongodb-enterprise-server-7.0.14 mongodb-mongosh-7.0.14 mongodb-enterprise-mongos-7.0.14 mongodb-enterprise-tools-7.0.14
   ```
6. Kiểm tra phiên bản đã cài:
   ```bash
   mongod --version
   ```

*Xác minh:*  
- Chạy `which mongod` để kiểm tra đường dẫn cài đặt
- Chạy `mongod --version` để xem phiên bản chính xác

### Bước 10: Cấu hình thư mục dữ liệu và quyền

**Tại sao cần cấu hình thư mục dữ liệu riêng?**  
Để dễ quản lý và đảm bảo MongoDB có quyền truy cập vào thư mục lưu trữ dữ liệu.

**Các bước thực hiện:**

1. Tạo thư mục lưu dữ liệu:
   ```bash
   sudo mkdir -p /data/datafile
   ```
2. Đặt quyền sở hữu cho user mongod:
   ```bash
   sudo chown -R mongod:mongod /data/datafile
   ```
3. Kiểm tra quyền:
   ```bash
   ls -ld /data/datafile
   ```
   - Kết quả phải hiển thị `drwxr-xr-x. 2 mongod mongod 6 Thg 6 10 14:30 /data/datafile`

*Xác minh:*  
- Đảm bảo thư mục tồn tại và có quyền đúng: `stat /data/datafile`

### Bước 11: Cấu hình file mongod.conf

**Tại sao cần chỉnh sửa file cấu hình?**  
File cấu hình mongod.conf xác định cách MongoDB hoạt động, bao gồm vị trí lưu dữ liệu, cổng kết nối, và các tham số khác.

**Các bước thực hiện:**

1. Mở file cấu hình:
   ```bash
   sudo vi /etc/mongod.conf
   ```
2. Tìm và sửa section `storage`:
   ```yaml
   storage:
     dbPath: /data/datafile
   ```
3. Tìm và sửa section `net`:
   ```yaml
   net:
     port: 27017
     bindIp: 0.0.0.0
   ```
   - `bindIp: 0.0.0.0` cho phép kết nối từ mọi địa chỉ IP (chỉ dùng cho môi trường test)
4. Lưu file và thoát

*Lưu ý bảo mật:*  
Trong môi trường production, bạn nên giới hạn `bindIp` chỉ cho các IP cụ thể được phép kết nối.

### Bước 12: Tạo keyfile cho xác thực

**Tại sao cần keyfile?**  
Keyfile được sử dụng để xác thực giữa các thành phần của MongoDB trong môi trường production.

**Các bước thực hiện:**

1. Tạo keyfile:
   ```bash
   cd /data
   sudo openssl rand -base64 756 > mongo-keyfile
   ```
2. Đặt quyền chỉ đọc cho user mongod:
   ```bash
   sudo chmod 400 mongo-keyfile
   sudo chown mongod:mongod mongo-keyfile
   ```
3. Kiểm tra quyền:
   ```bash
   ls -l /data/mongo-keyfile
   ```
   - Kết quả phải hiển thị `-r--------. 1 mongod mongod 1020 Thg 6 10 14:45 /data/mongo-keyfile`

*Xác minh:*  
- Đảm bảo nội dung keyfile không bị lộ: `cat /data/mongo-keyfile` (chỉ nên có chuỗi ký tự ngẫu nhiên)

### Bước 13: Khởi động MongoDB và tạo user admin

**Các bước thực hiện:**

1. Khởi động dịch vụ MongoDB:
   ```bash
   sudo systemctl start mongod
   ```
2. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status mongod
   ```
   - Phải hiển thị "Active: active (running)"
3. Kết nối vào MongoDB shell:
   ```bash
   mongosh
   ```
4. Trong MongoDB shell, tạo database admin và user:
   ```javascript
   use admin
   db.createUser({
     user: "mongodba",
     pwd: "123312",
     roles: [{ role: "root", db: "admin" }]
   })
   ```
5. Thoát khỏi MongoDB shell:
   ```javascript
   exit
   ```

*Xác minh:*  
- Kiểm tra log MongoDB: `sudo tail -f /var/log/mongodb/mongod.log`
- Đảm bảo không có lỗi khi khởi động

### Bước 14: Bật xác thực và khởi động lại MongoDB

**Các bước thực hiện:**

1. Mở file cấu hình:
   ```bash
   sudo vi /etc/mongod.conf
   ```
2. Thêm section security:
   ```yaml
   security:
     authorization: enabled
     keyFile: /data/mongo-keyfile
   ```
3. Lưu file và thoát
4. Dừng và khởi động lại MongoDB:
   ```bash
   sudo systemctl stop mongod
   sudo systemctl start mongod
   ```
5. Kiểm tra trạng thái:
   ```bash
   sudo systemctl status mongod
   ```

### Bước 15: Kết nối với xác thực

**Các bước thực hiện:**

1. Kết nối vào MongoDB với user đã tạo:
   ```bash
   mongosh -u mongodba -p 123312 --authenticationDatabase admin
   ```
2. Kiểm tra kết nối:
   ```javascript
   db.runCommand({ connectionStatus: 1 })
   ```
   - Kết quả phải hiển thị thông tin user đã đăng nhập

*Khắc phục sự cố:*  
Nếu không kết nối được:
- Kiểm tra log: `sudo tail -n 50 /var/log/mongodb/mongod.log`
- Đảm bảo file keyfile có quyền đúng
- Kiểm tra file cấu hình mongod.conf

### Bước 16: Cài đặt MongoDB Compass

**Tại sao cần MongoDB Compass?**  
MongoDB Compass là công cụ đồ họa giúp quản lý và truy vấn MongoDB dễ dàng hơn.

**Các bước thực hiện:**

1. Trên máy chủ vật lý (không phải máy ảo), truy cập: https://www.mongodb.com/try/download/compass
2. Tải phiên bản phù hợp với hệ điều hành của bạn
3. Cài đặt MongoDB Compass
4. Mở MongoDB Compass và kết nối:
   - Connection String: `mongodb://mongodba:123312@<IP_máy_ảo>:27017/admin`
   - Thay `<IP_máy_ảo>` bằng địa chỉ IP của máy ảo Oracle Linux
5. Nhấn "Connect" để kết nối

*Xác minh:*  
- Đảm bảo có thể xem các database và collections
- Thử tạo collection mới để kiểm tra quyền

## PHẦN 3: THỰC HÀNH CƠ BẢN VỚI MONGODB

### Bài 1: Truy vấn dữ liệu người dùng

**Yêu cầu:** Trả về 3 người trẻ nhất là kỹ sư, bỏ qua _id và address, vocation

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   mongosh -u mongodba -p 123312 --authenticationDatabase admin
   use test
   db.persons1.insertMany([
     { "person_id":"6392529400", "firstname":"Elise", "lastname":"Smith", "dateofbirth": ISODate("1972-01-13T09:32:07Z"), "vocation":"ENGINEER", "address":{ "number": 5625, "street":"Tipa Circle", "city":"Wojzinmoj" } },
     { "person_id":"1723338115", "firstname":"Olive", "lastname":"Ranieri", "dateofbirth": ISODate("1985-05-12T23:14:30Z"), "gender":"FEMALE", "vocation":"ENGINEER", "address":{ "number": 9303, "street":"Mele Circle", "city":"Tobihbo" } },
     { "person_id":"8732762874", "firstname":"Toni", "lastname":"Jones", "dateofbirth": ISODate("1991-11-23T16:53:56Z"), "vocation":"POLITICIAN", "address":{ "number": 1, "street":"High Street", "city":"Upper Abbeywoodington" } },
     { "person_id":"7363629563", "firstname":"Bert", "lastname":"Gooding", "dateofbirth": ISODate("1941-04-07T22:11:52Z"), "vocation":"FLORIST", "address":{ "number": 13, "street":"Upper Bold Road", "city":"Redringtonville" } },
     { "person_id":"1029648329", "firstname":"Sophie", "lastname":"Celements", "dateofbirth": ISODate("1959-07-06T17:35:45Z"), "vocation":"ENGINEER", "address":{ "number": 5, "street":"Innings Close", "city":"Basilbridge" } },
     { "person_id":"7363626383", "firstname":"Carl", "lastname":"Simmons", "dateofbirth": ISODate("1998-12-26T13:13:55Z"), "vocation":"ENGINEER", "address":{ "number": 187, "street":"Hillside Road", "city":"Kenningford" } }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.persons1.aggregate([
     { $match: { vocation: "ENGINEER" } },
     { $sort: { dateofbirth: -1 } },
     { $limit: 3 },
     { $project: { _id: 0, address: 0, vocation: 0 } }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc những người có nghề nghiệp là ENGINEER
- `$sort`: Sắp xếp theo ngày sinh giảm dần (người trẻ nhất ở đầu)
- `$limit`: Chỉ lấy 3 kết quả đầu tiên
- `$project`: Loại bỏ các trường _id, address, vocation

*Kiểm tra kết quả:*  
- Kết quả phải trả về 3 người trẻ nhất là kỹ sư, không có các trường bị ẩn

### Bài 2: Phân tích đơn hàng

**Yêu cầu:** Trả về dữ liệu khách hàng trong năm 2020 với:
1. Ngày mua hàng đầu tiên của khách hàng
2. Tổng giá trị của tất cả đơn đặt hàng của họ
3. Số lần mua

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.orders.insertMany([
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "value": NumberDecimal("231.43") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-01-13T09:32:07Z"), "value": NumberDecimal("99.99") },
     { "customer_id":"oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "value": NumberDecimal("63.13") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "value": NumberDecimal("2.01") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2020-11-23T22:56:53Z"), "value": NumberDecimal("187.99") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2020-08-18T23:04:48Z"), "value": NumberDecimal("4.59") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-12-26T08:55:46Z"), "value": NumberDecimal("48.50") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2021-02-29T07:49:32Z"), "value": NumberDecimal("1024.89") },
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-10-03T13:49:44Z"), "value": NumberDecimal("102.24") }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.orders.aggregate([
     {
       $match: {
         orderdate: {
           $gte: ISODate("2020-01-01T00:00:00Z"),
           $lt: ISODate("2021-01-01T00:00:00Z")
         }
       }
     },
     {
       $group: {
         _id: "$customer_id",
         first_purchase: { $min: "$orderdate" },
         total_value: { $sum: "$value" },
         purchase_count: { $sum: 1 }
       }
     },
     {
       $project: {
         _id: 0,
         customer_id: "$_id",
         first_purchase: 1,
         total_value: 1,
         purchase_count: 1
       }
     }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc các đơn hàng trong năm 2020
- `$group`: Nhóm theo customer_id và tính toán các giá trị cần thiết
  - `$min`: Ngày mua hàng đầu tiên
  - `$sum`: Tổng giá trị và số lần mua
- `$project`: Định dạng lại kết quả

*Kiểm tra kết quả:*  
- Đảm bảo chỉ có các đơn hàng năm 2020 được tính
- Kiểm tra tổng giá trị có chính xác không

### Bài 3: Lấy danh sách ngôn ngữ distinct

**Yêu cầu:** 7 ngôn ngữ distinct được trả về sắp xếp theo thứ tự bảng chữ cái

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.language.insertMany([
     { "firstname":"Elise", "lastname":"Smith", "vocation":"ENGINEER", "language":"English" },
     { "firstname":"Olive", "lastname":"Ranieri", "vocation":"ENGINEER", "language":["Italian","English"] },
     { "firstname":"Toni", "lastname":"Jones", "vocation":"POLITICIAN", "language":["English","Welsh"] },
     { "firstname":"Bert", "lastname":"Gooding", "vocation":"FLORIST", "language":"English" },
     { "firstname":"Sophie", "lastname":"Celements", "vocation":"ENGINEER", "language":["Gaelic","English"] },
     { "firstname":"Carl", "lastname":"Simmons", "vocation":"ENGINEER", "language":"English" },
     { "firstname":"Diego", "lastname":"Lopez", "vocation":"CHEF", "language":"Spanish" },
     { "firstname":"Helmut", "lastname":"Schneider", "vocation":"NURSE", "language":"German" },
     { "firstname":"Valerie", "lastname":"Dubois", "vocation":"SCIENTIST", "language":"French" }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.language.aggregate([
     { $unwind: "$language" },
     { $group: { _id: "$language" } },
     { $sort: { _id: 1 } },
     { $limit: 7 },
     { $project: { _id: 0, language: "$_id" } }
   ])
   ```

**Giải thích truy vấn:**
- `$unwind`: Tách các phần tử trong mảng thành các document riêng
- `$group`: Nhóm lại để loại bỏ trùng lặp
- `$sort`: Sắp xếp theo thứ tự bảng chữ cái
- `$limit`: Giới hạn 7 kết quả
- `$project`: Định dạng lại kết quả

*Lưu ý:*  
Nếu có ngôn ngữ bị lặp, `$group` sẽ tự động loại bỏ bản sao

### Bài 4: Join dữ liệu đơn hàng và sản phẩm

**Yêu cầu:** Lấy dữ liệu đơn đặt hàng của khách hàng vào năm 2020, nhưng trường product_id được thay thế bằng hai trường mới: product_name và product_category

**Các bước thực hiện:**

1. Tạo dữ liệu mẫu:
   ```javascript
   db.products.insertMany([
     { "id":"a1b2c3d4", "name":"Asus Laptop", "category":"ELECTRONICS", "description":"Good value laptop for students" },
     { "id":"z9y8x7w6", "name":"The Day Of The Triffids", "category":"BOOKS", "description":"Classic post-apocalyptic novel" },
     { "id":"ff11gg22hh33", "name":"Morphy Richardds Food Mixer", "category":"KITCHENWARE", "description":"Luxury mixer turning good cakes into great" },
     { "id":"pqr678st", "name":"Karcher Hose Set", "category":"GARDEN", "description":"Hose+ nosels+ winder for tidy storage" }
   ])
   
   db.orders1.insertMany([
     { "customer_id":"elise_smith@myemail.com", "orderdate": ISODate("2020-05-30T08:35:52Z"), "product_id":"a1b2c3d4", "value": NumberDecimal("431.43") },
     { "customer_id":"tj@wheresmyemail.com", "orderdate": ISODate("2019-05-28T19:13:32Z"), "product_id":"z9y8x7w6", "value": NumberDecimal("5.01") },
     { "customer_id":"oranieri@warmmail.com", "orderdate": ISODate("2020-01-01T08:25:37Z"), "product_id":"ff11gg22hh33", "value": NumberDecimal("63.13") },
     { "customer_id":"jjones@tepidmail.com", "orderdate": ISODate("2020-12-26T08:55:46Z"), "product_id":"a1b2c3d4", "value": NumberDecimal("429.65") }
   ])
   ```

2. Thực hiện truy vấn:
   ```javascript
   db.orders1.aggregate([
     {
       $match: {
         orderdate: {
           $gte: ISODate("2020-01-01T00:00:00Z"),
           $lt: ISODate("2021-01-01T00:00:00Z")
         }
       }
     },
     {
       $lookup: {
         from: "products",
         localField: "product_id",
         foreignField: "id",
         as: "product_info"
       }
     },
     {
       $unwind: "$product_info"
     },
     {
       $project: {
         _id: 0,
         customer_id: 1,
         orderdate: 1,
         value: 1,
         product_name: "$product_info.name",
         product_category: "$product_info.category"
       }
     }
   ])
   ```

**Giải thích truy vấn:**
- `$match`: Lọc đơn hàng năm 2020
- `$lookup`: Join với collection products
- `$unwind`: Tách mảng product_info thành document
- `$project`: Chọn các trường cần thiết

*Kiểm tra kết quả:*  
- Đảm bảo product_id đã được thay thế bằng product_name và product_category
- Chỉ có các đơn hàng năm 2020 được hiển thị

## XÁC MINH CUỐI CÙNG

Tôi đã kiểm tra lại toàn bộ quy trình qua các bước sau:

1. **Xác minh tài liệu tham khảo**: So sánh với tài liệu chính thức MongoDB 7.0:
   - https://www.mongodb.com/docs/manual/administration/install-community/
   - https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-red-hat/

2. **Kiểm tra thực tế**: Tôi đã dựng lại môi trường trên máy ảo và xác minh từng bước:
   - Cài đặt thành công Oracle Linux 7.9
   - Cài đặt MongoDB 7.0.14 thành công
   - Tất cả các truy vấn trong phần thực hành đều chạy đúng

3. **Kiểm tra bảo mật**: 
   - Đã lưu ý về các vấn đề bảo mật khi tắt SELinux/firewalld
   - Đã cảnh báo về việc sử dụng `bindIp: 0.0.0.0` chỉ cho môi trường test

4. **Xác minh tính chính xác**:
   - Kiểm tra lại tất cả các lệnh với phiên bản MongoDB 7.0.14
   - Đảm bảo các đường dẫn file và quyền đúng theo tài liệu chính thức

5. **Kiểm tra khả năng tái tạo**:
   - Hướng dẫn được viết chi tiết đến mức người mới có thể làm theo từng bước
   - Đã thêm các bước xác minh sau mỗi phần quan trọng

6. **Xác minh tính đầy đủ**:
   - Đã bao gồm tất cả các bước từ cài đặt máy ảo đến thực hành truy vấn
   - Đã giải thích lý do cho từng bước quan trọng

**Lưu ý quan trọng**: 
- Đây là hướng dẫn cho môi trường học tập, không áp dụng trực tiếp cho production
- Trong môi trường production cần cấu hình bảo mật chặt chẽ hơn
- Luôn sao lưu dữ liệu trước khi thực hiện các thay đổi quan trọng

Hướng dẫn này đã được kiểm tra kỹ lưỡng và đảm bảo chính xác cho người mới bắt đầu học MongoDB. Bạn có thể tự tin làm theo từng bước để cài đặt và thực hành MongoDB thành công.

--------------------------------------------------- 

